<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <script src="marked.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub README åˆ†æå™¨ | å®Œæ•´æ–‡æ¡£è´¨é‡è¯„ä¼°</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #2ecc71;
            --info: #3498db;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --gray-light: #ecf0f1;
            --border-radius: 16px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --box-shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            --gradient-success: linear-gradient(135deg, var(--success) 0%, #27ae60 100%);
            --gradient-warning: linear-gradient(135deg, var(--warning) 0%, #e67e22 100%);
            --gradient-danger: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 60px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path fill="white" d="M11,18.3C6.2,18.8,2,14.9,2,10c0-4.4,3.6-8,8-8s8,3.6,8,8c0,1.3-0.3,2.5-0.8,3.6l12.9,7.5c1.6-1.1,3.5-1.8,5.5-1.8 c2.1,0,4.1,0.7,5.7,1.9l12.9-7.4C52.3,4.5,52,3.3,52,2c0-1.1,0.2-2.1,0.6-3.1L40.2,7.9C38.1,6.3,35.5,5.3,32.7,5.3 c-6.1,0-11.2,4.3-12.4,10l-9.9-5.7C9.6,8.4,8.3,8,7,8C3.1,8,0,11.1,0,15c0,3.9,3.1,7,7,7c1.3,0,2.5-0.4,3.6-1l9.9,5.7 c0.3,5.7,4.9,10.3,10.6,10.6l5.7,9.9C35.6,48.5,35,49.7,35,51c0,3.9,3.1,7,7,7s7-3.1,7-7c0-1.3-0.4-2.5-1-3.6l-5.7-9.9 c5.7-0.3,10.3-4.9,10.6-10.6l9.9,5.7c1,0.6,2.3,1,3.6,1c3.9,0,7-3.1,7-7c0-3.9-3.1-7-7-7c-1.3,0-2.5,0.4-3.6,1l-9.9-5.7 c-0.3-5.7-4.9-10.3-10.6-10.6l-5.7-9.9C48.5,9.6,49.7,10,51,10c3.9,0,7-3.1,7-7S54.9-4,51-4c-1.3,0-2.5,0.4-3.6,1l5.7,9.9 c-5.7,0.3-10.3,4.9-10.6,10.6L30.6,9.8c-1-0.6-2.3-1-3.6-1c-1.3,0-2.5,0.4-3.6,1l5.7,9.9c-5.7,0.3-10.3,4.9-10.6,10.6L11,18.3z"/></svg>');
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 15px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .header-subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto 25px;
        }

        .header-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ä¸»å†…å®¹åŒº */
        .content {
            padding: 50px;
        }

        /* è¾“å…¥åŒºåŸŸ */
        .input-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 50px;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--gray-light);
        }

        .input-group {
            margin-bottom: 30px;
        }

        .input-group label {
            display: block;
            margin-bottom: 15px;
            font-weight: 700;
            color: var(--dark);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .url-input-container {
            position: relative;
        }

        .url-input {
            width: 100%;
            padding: 20px 25px 20px 60px;
            border: 2px solid var(--gray-light);
            border-radius: 15px;
            font-size: 1.1rem;
            transition: var(--transition);
            background: white;
            font-family: 'Consolas', 'Monaco', monospace;
            box-shadow: 0 4px 12px rgba(50, 50, 93, 0.08);
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 6px 20px rgba(67, 97, 238, 0.15);
            transform: translateY(-3px);
        }

        .url-input-container i {
            position: absolute;
            left: 25px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1.4rem;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            box-shadow: 0 8px 25px rgba(67, 97, 238, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }

            100% {
                transform: scale(20, 20);
                opacity: 0;
            }
        }

        .btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 35px rgba(67, 97, 238, 0.4);
        }

        .btn:active {
            transform: translateY(-2px);
        }

        .btn-full {
            width: 100%;
        }

        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        /* åˆ†æå¡ç‰‡é€šç”¨æ ·å¼ */
        .analysis-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            border: 1px solid var(--gray-light);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .analysis-card:hover {
            box-shadow: var(--box-shadow-hover);
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .card-icon {
            width: 70px;
            height: 70px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .card-title {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--dark);
            margin: 0;
        }

        .card-subtitle {
            color: var(--gray);
            font-size: 1.1rem;
            margin-top: 5px;
        }

        /* è¯„åˆ†å¡ç‰‡ */
        .score-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 60px 40px;
            border-radius: 20px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
        }

        .overall-score {
            font-size: 6rem;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
        }

        .score-label {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .score-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .score-progress {
            height: 100%;
            background: linear-gradient(90deg, #ff9a9e, #fad0c4);
            border-radius: 6px;
            transition: width 2s ease-in-out;
        }

        /* ç»´åº¦è¯„åˆ†ç½‘æ ¼ */
        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .dimension-item {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid var(--primary);
            transition: var(--transition);
        }

        .dimension-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .dimension-name {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark);
        }

        .dimension-score {
            font-weight: 800;
            font-size: 1.8rem;
            color: var(--primary);
        }

        .dimension-bar {
            height: 8px;
            background: var(--gray-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .dimension-progress {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 1.5s ease-in-out;
        }

        /* å¯è¯»æ€§æŒ‡æ ‡ */
        .readability-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid var(--gray-light);
            text-align: center;
            transition: var(--transition);
        }

        .metric-item:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .metric-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .metric-description {
            color: var(--gray);
            font-size: 0.9rem;
        }

        /* åˆ—è¡¨æ ·å¼ */
        .analysis-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }

        .list-item {
            background: var(--light);
            padding: 25px;
            border-radius: 15px;
            display: flex;
            align-items: flex-start;
            gap: 20px;
            transition: var(--transition);
            border-left: 4px solid;
        }

        .list-item:hover {
            transform: translateX(10px);
        }

        .list-item-strength {
            border-left-color: var(--success);
            background: linear-gradient(to right, rgba(46, 204, 113, 0.1), white);
        }

        .list-item-warning {
            border-left-color: var(--warning);
            background: linear-gradient(to right, rgba(243, 156, 18, 0.1), white);
        }

        .list-item-danger {
            border-left-color: var(--danger);
            background: linear-gradient(to right, rgba(231, 76, 60, 0.1), white);
        }

        .list-item-info {
            border-left-color: var(--info);
            background: linear-gradient(to right, rgba(52, 152, 219, 0.1), white);
        }

        .item-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .list-item-strength .item-number {
            background: var(--success);
        }

        .list-item-warning .item-number {
            background: var(--warning);
        }

        .list-item-danger .item-number {
            background: var(--danger);
        }

        .list-item-info .item-number {
            background: var(--info);
        }

        .item-content {
            flex: 1;
        }

        .item-title {
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .item-description {
            color: var(--gray);
            line-height: 1.7;
        }

        /* æ ‡ç­¾äº‘ */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
        }

        .tag {
            padding: 12px 25px;
            background: var(--light);
            border-radius: 50px;
            font-weight: 600;
            color: var(--dark);
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .tag:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tag-high {
            background: rgba(46, 204, 113, 0.2);
            border-color: var(--success);
        }

        .tag-medium {
            background: rgba(243, 156, 18, 0.2);
            border-color: var(--warning);
        }

        .tag-low {
            background: rgba(231, 76, 60, 0.2);
            border-color: var(--danger);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 100px 20px;
            display: none;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 8px solid rgba(67, 97, 238, 0.1);
            border-top: 8px solid var(--primary);
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
            margin: 0 auto 30px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 12px;
            }

            .header {
                padding: 40px 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 25px;
            }

            .input-section {
                padding: 25px;
            }

            .analysis-card {
                padding: 25px;
            }

            .dimensions-grid {
                grid-template-columns: 1fr;
            }

            .readability-metrics {
                grid-template-columns: 1fr;
            }

            .btn {
                padding: 15px 25px;
                font-size: 1rem;
            }
        }

        /* åŠ¨ç”»ç±» */
        .animate-in {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .delay-1 {
            animation-delay: 0.1s;
        }

        .delay-2 {
            animation-delay: 0.2s;
        }

        .delay-3 {
            animation-delay: 0.3s;
        }

        .delay-4 {
            animation-delay: 0.4s;
        }

        .delay-5 {
            animation-delay: 0.5s;
        }

        /* è¿›åº¦æ¡åŠ¨ç”» */
        @keyframes grow {
            from {
                width: 0;
            }
        }

        /* å·¥å…·æç¤º */
        .tooltip {
            position: relative;
            cursor: help;
            border-bottom: 1px dashed var(--gray);
        }

        .tooltip-text {
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            width: 250px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .tooltip:hover .tooltip-text {
            opacity: 1;
            visibility: visible;
        }

        /* æŠ˜å é¢æ¿ */
        .collapse {
            margin-top: 20px;
        }

        .collapse-header {
            background: var(--light);
            padding: 20px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .collapse-header:hover {
            background: #e8f4fc;
        }

        .collapse-content {
            padding: 25px;
            background: white;
            border-radius: 0 0 12px 12px;
            border: 1px solid var(--gray-light);
            border-top: none;
            display: none;
        }

        .collapse.active .collapse-content {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        .collapse.active .collapse-header {
            border-radius: 12px 12px 0 0;
            background: #e8f4fc;
        }

        /* ç»“æœå¯¼èˆª */
        .result-nav {
            position: sticky;
            top: 20px;
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            z-index: 100;
        }

        .nav-list {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .nav-item {
            padding: 10px 20px;
            background: var(--light);
            border-radius: 50px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .nav-item:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        .nav-item.active {
            background: var(--primary);
            color: white;
        }

        /* æ–‡æ¡£æ ‡ç­¾é¡µæ ·å¼ */
        .doc-tab {
            padding: 10px 16px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .doc-tab:hover {
            background: #e0e0e0;
            color: #333;
        }

        .doc-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .doc-tab .doc-size {
            font-size: 12px;
            opacity: 0.8;
            font-weight: normal;
        }

        .doc-tab.active .doc-size {
            opacity: 0.9;
        }

        /* ä¼˜åŒ–åŠŸèƒ½æŒ‰é’®æ ·å¼ */
        .btn-secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        /* æ–‡æ¡£å¯¹æ¯”å±•ç¤ºæ ·å¼ */
        .document-comparison {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--box-shadow);
            background: white;
            transition: var(--transition);
        }

        .document-comparison:hover {
            box-shadow: var(--box-shadow-hover);
            transform: translateY(-2px);
        }

        .comparison-header {
            padding: 20px 25px;
            background: var(--gradient-primary);
            color: white;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
        }

        .comparison-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .original-title {
            background: var(--gradient-danger);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .optimized-title {
            background: var(--gradient-success);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .comparison-title i {
            margin-right: 10px;
            opacity: 0.9;
        }

        .doc-stats {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            white-space: nowrap;
        }

        .document-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 0;
            background: #fafbfc;
            border: none;
        }

        .original-content {
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            border-left: 4px solid var(--danger);
        }

        .optimized-content {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 100%);
            border-left: 4px solid var(--success);
        }

        /* Markdownå†…å®¹æ ·å¼ */
        .markdown-content {
            padding: 25px;
            line-height: 1.6;
            color: var(--dark);
        }

        .original-content .markdown-content {
            color: #c62828;
        }

        .optimized-content .markdown-content {
            color: #2e7d32;
        }

        /* Markdownå…ƒç´ æ ·å¼ */
        .markdown-content h1,
        .markdown-content h2,
        .markdown-content h3,
        .markdown-content h4,
        .markdown-content h5,
        .markdown-content h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.3;
        }

        .markdown-content h1 {
            font-size: 1.8em;
        }

        .markdown-content h2 {
            font-size: 1.5em;
        }

        .markdown-content h3 {
            font-size: 1.3em;
        }

        .markdown-content h4 {
            font-size: 1.1em;
        }

        .markdown-content p {
            margin-bottom: 16px;
        }

        .markdown-content ul,
        .markdown-content ol {
            margin-bottom: 16px;
            padding-left: 30px;
        }

        .markdown-content li {
            margin-bottom: 8px;
        }

        .markdown-content code {
            background: rgba(0, 0, 0, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 0.9em;
        }

        .markdown-content pre {
            background: rgba(0, 0, 0, 0.05);
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 16px;
            font-family: 'JetBrains Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 13px;
            line-height: 1.4;
        }

        .markdown-content pre code {
            background: none;
            padding: 0;
        }

        .markdown-content blockquote {
            border-left: 4px solid rgba(0, 0, 0, 0.1);
            padding-left: 16px;
            margin-left: 0;
            margin-bottom: 16px;
            color: rgba(0, 0, 0, 0.7);
            font-style: italic;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 16px;
        }

        .markdown-content th,
        .markdown-content td {
            border: 1px solid rgba(0, 0, 0, 0.1);
            padding: 8px 12px;
            text-align: left;
        }

        .markdown-content th {
            background: rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .markdown-content a {
            color: var(--primary);
            text-decoration: none;
        }

        .markdown-content a:hover {
            text-decoration: underline;
        }

        .content-truncate {
            margin-top: 16px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 6px;
            font-style: italic;
            color: rgba(0, 0, 0, 0.6);
            text-align: center;
        }

        /* ä¼˜åŒ–ç»Ÿè®¡æ ·å¼å¢å¼º */
        .optimization-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--box-shadow-hover);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 8px;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        .document-content::-webkit-scrollbar {
            width: 8px;
        }

        .document-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .document-content::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .document-content::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* ä¼˜åŒ–ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        .optimization-summary-card {
            margin-top: 30px;
            background: linear-gradient(135deg, #f8f9ff 0%, #e8f2ff 100%);
            border-radius: 16px;
            padding: 30px;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(52, 152, 219, 0.1);
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-header i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .summary-header h4 {
            color: var(--dark);
            font-size: 1.4rem;
            font-weight: 700;
            margin: 0;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .document-comparison {
                margin-bottom: 20px;
            }

            .comparison-title {
                font-size: 1.1rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .doc-stats {
                align-self: flex-end;
            }

            .document-content pre {
                font-size: 13px;
                padding: 20px;
            }

            .markdown-content {
                padding: 20px;
                font-size: 14px;
            }

            .markdown-content h1 {
                font-size: 1.5em;
            }

            .markdown-content h2 {
                font-size: 1.3em;
            }

            .markdown-content h3 {
                font-size: 1.2em;
            }

            .markdown-content pre {
                font-size: 12px;
                padding: 12px;
            }

            .optimization-summary-card {
                padding: 20px;
            }

            .optimization-stats {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1><i class="fas fa-chart-line"></i> GitHub README æ·±åº¦åˆ†æå™¨</h1>
                <p class="header-subtitle">å…¨é¢åˆ†æ GitHub ä»“åº“çš„ README æ–‡æ¡£è´¨é‡ï¼Œæä¾›ä¸“ä¸šæ”¹è¿›å»ºè®®å’Œå¯è¯»æ€§è¯„ä¼°</p>
                <div class="header-stats">
                    <div class="stat-item">
                        <div class="stat-number">10+</div>
                        <div class="stat-label">åˆ†æç»´åº¦</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">è¯„ä¼°æŒ‡æ ‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">å…¨é¢è¦†ç›–</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="input-section animate-in">
                <div class="input-group">
                    <label for="repoUrl"><i class="fas fa-link"></i> GitHub ä»“åº“åœ°å€</label>
                    <div class="url-input-container">
                        <i class="fab fa-github"></i>
                        <input type="text" id="repoUrl" class="url-input"
                            placeholder="è¾“å…¥ GitHub ä»“åº“åœ°å€ï¼Œä¾‹å¦‚ï¼švuejs/vue æˆ– https://github.com/vuejs/vue" value="vuejs/vue">
                    </div>

                    <div style="margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
                        <p><i class="fas fa-lightbulb"></i> <strong>æ”¯æŒæ ¼å¼ï¼š</strong></p>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;">
                            <span class="tag">github.com/username/repo</span>
                            <span class="tag">username/repo</span>
                            <span class="tag">https://github.com/username/repo</span>
                            <span class="tag">git@github.com:username/repo.git</span>
                        </div>
                    </div>
                </div>

                <button id="analyzeBtn" class="btn btn-full" onclick="performAnalysis()">
                    <i class="fas fa-magic"></i>
                    <span>æ‰«æä»“åº“æ–‡æ¡£</span>
                </button>

                <div style="text-align: center; margin-top: 20px; color: var(--gray); font-size: 0.9rem;">
                    <i class="fas fa-info-circle"></i> åˆ†æè¿‡ç¨‹åŒ…æ‹¬æ–‡æ¡£ç»“æ„ã€å†…å®¹è´¨é‡ã€å¯è¯»æ€§ã€ä»£ç ç¤ºä¾‹ç­‰10+ä¸ªç»´åº¦
                </div>
            </div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <h3 id="loadingTitle">æ­£åœ¨æ‰«æä»“åº“...</h3>
                <p id="loadingDescription"
                    style="margin-top: 20px; color: var(--gray); max-width: 600px; margin: 20px auto;">
                    æ­£åœ¨æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡æ¡£æ–‡ä»¶...
                </p>
                <div id="progressText" style="margin-top: 30px; font-weight: 600;"></div>
            </div>

            <!-- ç»“æœåŒºåŸŸ -->
            <div id="result" style="display: none;">
                <!-- ç»“æœå°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            const analyzeBtn = document.getElementById('analyzeBtn');
            const repoUrlInput = document.getElementById('repoUrl');

            analyzeBtn.addEventListener('click', performAnalysis);
            repoUrlInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    performAnalysis();
                }
            });

            // æ·»åŠ ç¤ºä¾‹å¿«é€Ÿè¾“å…¥
            const examples = [
                { name: 'Vue.js', repo: 'vuejs/vue' },
                { name: 'React', repo: 'facebook/react' },
                { name: 'TensorFlow', repo: 'tensorflow/tensorflow' },
                { name: 'VS Code', repo: 'microsoft/vscode' },
                { name: 'Django', repo: 'django/django' }
            ];

            const inputSection = document.querySelector('.input-section');
            const exampleContainer = document.createElement('div');
            exampleContainer.style.marginTop = '30px';
            exampleContainer.innerHTML = `
                <div style="color: var(--gray); margin-bottom: 10px; font-weight: 600;">
                    <i class="fas fa-bolt"></i> å¿«é€Ÿåˆ†æç¤ºä¾‹ï¼š
                </div>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    ${examples.map(example => `
                        <button class="tag" onclick="setExample('${example.repo}')" 
                                style="cursor: pointer; border: 2px solid var(--primary);">
                            ${example.name}
                        </button>
                    `).join('')}
                </div>
            `;
            inputSection.appendChild(exampleContainer);
        });

        function setExample(repo) {
            document.getElementById('repoUrl').value = repo;
            document.getElementById('repoUrl').focus();
        }

        function generateDocSelector(docs) {
            const availableDocs = Object.keys(docs).filter(key => docs[key] && docs[key].content);

            console.log('Setting up checkboxes for docs:', availableDocs);

            // ä¸ºæ¯ä¸ªcheckboxæ·»åŠ äº‹ä»¶å¤„ç†
            availableDocs.forEach(docType => {
                const checkbox = document.getElementById(`checkbox-${docType}`);
                const checkboxItem = checkbox.closest('.checkbox-item');

                if (checkbox && checkboxItem) {
                    // é¼ æ ‡æ‚¬åœæ•ˆæœ
                    checkboxItem.addEventListener('mouseenter', () => {
                        checkboxItem.style.borderColor = 'var(--primary)';
                        checkboxItem.style.transform = 'translateY(-2px)';
                        checkboxItem.style.boxShadow = '0 4px 12px rgba(67, 97, 238, 0.15)';
                    });
                    checkboxItem.addEventListener('mouseleave', () => {
                        checkboxItem.style.borderColor = 'var(--gray-light)';
                        checkboxItem.style.transform = 'translateY(0)';
                        checkboxItem.style.boxShadow = 'none';
                    });

                    // ç‚¹å‡»æ•´ä¸ªåŒºåŸŸåˆ‡æ¢checkbox
                    checkboxItem.addEventListener('click', (e) => {
                        if (e.target !== checkbox) {
                            e.preventDefault();
                            checkbox.checked = !checkbox.checked;
                            console.log('Toggled checkbox:', checkbox.value, 'to', checkbox.checked);
                        }
                    });

                    // checkboxçŠ¶æ€å˜åŒ–æ—¶æ›´æ–°æ ·å¼
                    checkbox.addEventListener('change', () => {
                        console.log('Checkbox changed:', checkbox.value, 'to', checkbox.checked);
                        if (checkbox.checked) {
                            checkboxItem.style.background = 'linear-gradient(135deg, #f0f8ff, #e6f3ff)';
                            checkboxItem.style.borderColor = 'var(--primary)';
                        } else {
                            checkboxItem.style.background = 'white';
                            checkboxItem.style.borderColor = 'var(--gray-light)';
                        }
                    });

                    // åˆå§‹åŒ–æ ·å¼
                    if (checkbox.checked) {
                        checkboxItem.style.background = 'linear-gradient(135deg, #f0f8ff, #e6f3ff)';
                        checkboxItem.style.borderColor = 'var(--primary)';
                    }
                }
            });
        }

        function getSelectedDocTypes() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][id^="checkbox-"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        async function performAnalysis() {
            // é˜²æ­¢é‡å¤è°ƒç”¨
            if (window.isScanningRunning) {
                console.log('Scanning already running, ignoring duplicate call');
                return;
            }
            window.isScanningRunning = true;

            const repoUrl = document.getElementById('repoUrl').value.trim();
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById('result');

            if (!repoUrl) {
                alert('è¯·è¾“å…¥GitHubä»“åº“åœ°å€');
                return;
            }

            // æ ‡å‡†åŒ–URLè¾“å…¥
            let processedUrl = repoUrl;
            if (!processedUrl.includes('github.com') && !processedUrl.includes('/')) {
                processedUrl = 'https://github.com/' + processedUrl;
            } else if (!processedUrl.startsWith('http') && processedUrl.includes('github.com')) {
                processedUrl = 'https://' + processedUrl;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>æ‰«æä»“åº“ä¸­...</span>';
            loading.style.display = 'block';
            resultDiv.style.display = 'none';

            // è®¾ç½®æ‰«æé˜¶æ®µçš„æ–‡å­—
            document.getElementById('loadingTitle').textContent = 'æ­£åœ¨æ‰«æä»“åº“...';
            document.getElementById('loadingDescription').textContent = 'æ­£åœ¨æ£€æŸ¥ä»“åº“ä¸­çš„æ–‡æ¡£æ–‡ä»¶...';

            try {
                // ç¬¬ä¸€æ­¥ï¼šæ‰«æä»“åº“æ–‡æ¡£
                const downloadResponse = await fetch('http://localhost:8000/api/scan-repo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ repo_url: processedUrl })
                });

                if (!downloadResponse.ok) {
                    throw new Error(`æ‰«æå¤±è´¥: ${downloadResponse.status}`);
                }

                const downloadData = await downloadResponse.json();

                if (!downloadData.success) {
                    throw new Error(downloadData.error || 'æ‰«æå¤±è´¥');
                }

                // éšè—åŠ è½½çŠ¶æ€
                loading.style.display = 'none';

                // æ˜¾ç¤ºæ–‡æ¡£é€‰æ‹©ç•Œé¢
                showDocumentSelector(downloadData);

                // æ¢å¤æŒ‰é’®çŠ¶æ€ï¼Œä½†æ”¹å˜æ–‡å­—
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-play"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                analyzeBtn.onclick = startDeepAnalysis;

                // æ¸…ç†æ ‡è®°
                window.isScanningRunning = false;

                // ä¿å­˜æ‰«æç»“æœä¾›åç»­åˆ†æä½¿ç”¨
                window.scannedData = downloadData;

            } catch (error) {
                // æ¸…ç†æ ‡è®°
                window.isScanningRunning = false;

                loading.style.display = 'none';
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                analyzeBtn.onclick = startDeepAnalysis;
                showError(error.message);
            }
        }

        function showDocumentSelector(data) {
            const resultDiv = document.getElementById('result');
            const repoInfo = data.repo_info;
            const stats = data.stats;

            resultDiv.innerHTML = `
                <div class="analysis-card animate-in">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-primary);">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>
                            <h2 class="card-title">ğŸ“‹ ä»“åº“æ‰«æå®Œæˆ</h2>
                            <p class="card-subtitle">åœ¨ ${repoInfo.full_name} ä¸­æ‰¾åˆ° ${stats.found_count}/${stats.total_types} ä¸ªæ–‡æ¡£</p>
                        </div>
                    </div>

                    <div class="analysis-content">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">
                            <i class="fas fa-check-circle"></i> å‘ç°çš„æ–‡æ¡£
                        </h3>

                        <div class="analysis-list">
                            ${getAvailableDocs(data.docs).map(docType => {
                const docInfo = data.docs[docType];
                const labels = {
                    'readme': 'ğŸ“„ README',
                    'contributing': 'ğŸ¤ CONTRIBUTING',
                    'code_of_conduct': 'âš–ï¸ CODE_OF_CONDUCT',
                    'license': 'ğŸ“‹ LICENSE',
                    'changelog': 'ğŸ“ CHANGELOG',
                    'security': 'ğŸ”’ SECURITY',
                    'support': 'ğŸ†˜ SUPPORT',
                    'wiki': 'ğŸ“š WIKI',
                    'docs': 'ğŸ“– DOCS',
                    'installation': 'âš™ï¸ INSTALLATION',
                    'usage': 'ğŸš€ USAGE',
                    'api': 'ğŸ”— API'
                };

                return `
                                    <div class="list-item list-item-strength">
                                        <div style="display: flex; align-items: center; gap: 15px; width: 100%;">
                                            <div class="checkbox-item" style="display: flex; align-items: center; gap: 8px; margin: 0;">
                                                <input type="checkbox" id="checkbox-${docType}" value="${docType}" ${docType === 'readme' ? 'checked' : ''} style="margin: 0; cursor: pointer; width: 18px; height: 18px;">
                                                <label for="checkbox-${docType}" style="cursor: pointer; margin: 0; font-weight: 600; color: var(--dark);">${labels[docType] || docType.toUpperCase()}</label>
                                            </div>
                                            <div class="item-content" style="flex: 1; margin-left: auto;">
                                                <div class="item-description" style="text-align: right; color: var(--gray);">
                                                    ${docInfo.filename} â€¢ ${(docInfo.size / 1024).toFixed(2)} KB
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `;
            }).join('')}
                        </div>

                        <div style="margin-top: 40px; text-align: center;">
                            <p style="color: var(--gray); margin-bottom: 20px;">
                                <i class="fas fa-info-circle"></i> è¯·å‹¾é€‰è¦åˆ†æçš„æ–‡æ¡£ç±»å‹ï¼Œç„¶åç‚¹å‡»"å¼€å§‹æ·±åº¦åˆ†æ"
                            </p>
                            <button class="btn" onclick="startDeepAnalysis()">
                                <i class="fas fa-chart-line"></i> å¼€å§‹æ·±åº¦åˆ†æ
                            </button>
                        </div>
                    </div>
                </div>
            `;

            resultDiv.style.display = 'block';

            // ç”Ÿæˆæ–‡æ¡£é€‰æ‹©æ¡†
            setTimeout(() => {
                generateDocSelector(data.docs);
            }, 100);

            window.scrollTo({ top: resultDiv.offsetTop - 50, behavior: 'smooth' });
        }

        function getAvailableDocs(docs) {
            return Object.keys(docs).filter(key => docs[key] && docs[key].content);
        }

        async function startDeepAnalysis() {
            // é˜²æ­¢é‡å¤è°ƒç”¨
            if (window.isAnalysisRunning) {
                console.log('Analysis already running, ignoring duplicate call');
                return;
            }
            window.isAnalysisRunning = true;

            const selectedTypes = getSelectedDocTypes();
            if (selectedTypes.length === 0) {
                window.isAnalysisRunning = false;
                alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£è¿›è¡Œåˆ†æ');
                return;
            }

            // æ£€æŸ¥æ–‡æ¡£æ•°é‡å’Œé“¾æ¥æ•°é‡ï¼Œç»™å‡ºæ€§èƒ½æç¤º
            const totalDocs = selectedTypes.length;
            let totalLinks = 0;
            let highLinkDocs = [];

            selectedTypes.forEach(docType => {
                const doc = window.scannedData.docs[docType];
                if (doc && doc.content) {
                    const linkCount = (doc.content.match(/https?:\/\/[^\s<>"{}|\\^`\[\]]+/g) || []).length;
                    totalLinks += linkCount;
                    if (linkCount > 20) {
                        highLinkDocs.push(`${docType}(${linkCount}ä¸ªé“¾æ¥)`);
                    }
                }
            });

            // æ ¹æ®æ–‡æ¡£æ•°é‡å’Œé“¾æ¥æ•°é‡ç»™å‡ºä¸åŒçº§åˆ«çš„æç¤º
            let warningMessage = "";
            if (totalDocs > 3) {
                warningMessage = `æ‚¨é€‰æ‹©äº†${totalDocs}ä¸ªæ–‡æ¡£è¿›è¡Œåˆ†æï¼Œè¿™å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ã€‚`;
            } else if (totalLinks > 30) {
                warningMessage = `æ£€æµ‹åˆ°æ€»å…±${totalLinks}ä¸ªé“¾æ¥éœ€è¦æ£€æŸ¥ï¼Œè¿™å¯èƒ½éœ€è¦1-2åˆ†é’Ÿã€‚`;
            } else if (highLinkDocs.length > 0) {
                warningMessage = `æ–‡æ¡£ ${highLinkDocs.join(', ')} åŒ…å«è¾ƒå¤šé“¾æ¥ï¼Œåˆ†æå¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´ã€‚`;
            }

            if (warningMessage) {
                const details = [];
                if (totalDocs > 1) details.push("å»ºè®®å…ˆé€‰æ‹©1-2ä¸ªæ–‡æ¡£æµ‹è¯•");
                if (totalLinks > 50) details.push("å¤§é‡é“¾æ¥ä¼šæ˜¾è‘—å¢åŠ åˆ†ææ—¶é—´");

                const fullMessage = warningMessage + "\n\n" + details.join("\n") + "\n\nç¡®å®šç»§ç»­å—ï¼Ÿ";

                if (!confirm(fullMessage)) {
                    // ç”¨æˆ·å–æ¶ˆåˆ†æï¼Œç»™å‡ºæç¤º
                    showEnhancedError("åˆ†æå·²å–æ¶ˆ", [
                        "æ‚¨å–æ¶ˆäº†åˆ†æè¯·æ±‚",
                        "å¯ä»¥é‡æ–°é€‰æ‹©è¾ƒå°‘çš„æ–‡æ¡£å†è¯•",
                        "æˆ–è€…ç›´æ¥ç‚¹å‡»å¼€å§‹æ·±åº¦åˆ†æ"
                    ]);
                    return;
                }
            }

            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById('result');

            // æ˜¾ç¤ºåˆ†æåŠ è½½çŠ¶æ€
            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>åˆ†æä¸­...</span>';
            // æ·»åŠ å–æ¶ˆæŒ‰é’®
            const cancelBtn = document.createElement('button');
            cancelBtn.className = 'btn btn-outline';
            cancelBtn.innerHTML = '<i class="fas fa-times"></i> å–æ¶ˆåˆ†æ';
            cancelBtn.onclick = () => {
                if (confirm('ç¡®å®šè¦å–æ¶ˆåˆ†æå—ï¼Ÿ')) {
                    clearInterval(progressInterval);
                    showEnhancedError('åˆ†æå·²å–æ¶ˆ', ['æ‚¨å¯ä»¥é‡æ–°é€‰æ‹©æ–‡æ¡£è¿›è¡Œåˆ†æ', 'å°è¯•é€‰æ‹©æ›´å°‘çš„æ–‡æ¡£ä»¥åŠ å¿«é€Ÿåº¦']);
                    analyzeBtn.disabled = false;
                    analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                    analyzeBtn.onclick = startDeepAnalysis;
                    loading.style.display = 'none';
                }
            };
            analyzeBtn.parentNode.appendChild(cancelBtn);
            window.currentCancelBtn = cancelBtn;

            loading.style.display = 'block';
            resultDiv.style.display = 'none';

            // è®¾ç½®åˆ†æé˜¶æ®µçš„æ–‡å­—
            document.getElementById('loadingTitle').textContent = 'æ­£åœ¨æ·±åº¦åˆ†ææ–‡æ¡£...';
            document.getElementById('loadingDescription').innerHTML = `
                åˆ†æè¿‡ç¨‹åŒ…æ‹¬ï¼š<br>
                â€¢ è¯„ä¼°æ–‡æ¡£ç»“æ„å’Œå®Œæ•´æ€§<br>
                â€¢ åˆ†æå¯è¯»æ€§å’Œè¯­è¨€è´¨é‡<br>
                â€¢ æ£€æŸ¥ä»£ç ç¤ºä¾‹å’Œæœ€ä½³å®è·µ<br>
                â€¢ ç”Ÿæˆç»¼åˆè¯„åˆ†å’Œæ”¹è¿›å»ºè®®
            `;

            // æ›´æ–°è¿›åº¦
            const progressText = document.getElementById('progressText');
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 10;
                progressText.textContent = `åˆ†æè¿›åº¦: ${Math.min(progress, 90)}%`;
            }, 1000);

            try {
                // è°ƒç”¨æ·±åº¦åˆ†ææ¥å£
                progressText.textContent = 'æ­£åœ¨æ‰§è¡Œæ·±åº¦åˆ†æ...';
                const analysisResponse = await fetch('http://localhost:8000/api/analyze-project', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        docs: window.scannedData.docs,
                        selected_doc_types: selectedTypes
                    })
                });

                if (!analysisResponse.ok) {
                    const errorText = await analysisResponse.text();
                    throw new Error(`HTTP error! status: ${analysisResponse.status}, message: ${errorText}`);
                }

                const analysisData = await analysisResponse.json();

                // å¤„ç†åç«¯å¯èƒ½çš„é”™è¯¯æˆ–ä¸å®Œæ•´æ•°æ®
                if (!analysisData || !analysisData.success) {
                    throw new Error(analysisData?.error || "åˆ†æå¤±è´¥ï¼šåç«¯è¿”å›æ— æ•ˆæ•°æ®");
                }

                // æ£€æŸ¥rule_checksæ•°æ®å®Œæ•´æ€§
                if (analysisData.rule_checks) {
                    for (const [docType, checks] of Object.entries(analysisData.rule_checks)) {
                        if (!checks || !checks.summary) {
                            console.warn(`æ–‡æ¡£ ${docType} çš„æ£€æŸ¥ç»“æœä¸å®Œæ•´`);
                            // æä¾›é»˜è®¤å€¼
                            analysisData.rule_checks[docType] = {
                                summary: { total_issues: 0, passed_checks: 0, failed_checks: 0, overall_passed: false },
                                link_check: { valid_links: 0, invalid_links: 0, timeout_links: 0 },
                                code_block_check: { blocks_with_language: 0, blocks_without_language: 0 },
                                heading_structure_check: { total_headings: 0, issues: [] },
                                section_completeness_check: { found_sections: 0, missing_sections: [] }
                            };
                        }
                    }
                }

                // æ›´æ–°æœ€ç»ˆè¿›åº¦
                clearInterval(progressInterval);
                progressText.textContent = 'åˆ†æå®Œæˆï¼æ­£åœ¨ç”ŸæˆæŠ¥å‘Š...';

                // æ¸…ç†å–æ¶ˆæŒ‰é’®
                if (window.currentCancelBtn) {
                    window.currentCancelBtn.remove();
                    window.currentCancelBtn = null;
                }

                // ä¿å­˜åˆ†ææ•°æ®ä¾›ä¼˜åŒ–åŠŸèƒ½ä½¿ç”¨
                window.analysisData = analysisData;

                // ä¿å­˜é€‰ä¸­çš„æ–‡æ¡£ï¼ˆåªåŒ…å«ç”¨æˆ·å‹¾é€‰çš„æ–‡æ¡£ï¼‰
                window.selectedDocs = analysisData.selected_docs || {};
                console.log('ä¿å­˜é€‰ä¸­çš„æ–‡æ¡£:', Object.keys(window.selectedDocs));

                // æ˜¾ç¤ºåˆ†æç»“æœ
                showAnalysisResults(window.scannedData, analysisData.readability || {}, analysisData);

                // è®¾ç½®é»˜è®¤æ–‡æ¡£å†…å®¹ï¼ˆREADMEæˆ–ç¬¬ä¸€ä¸ªå¯ç”¨æ–‡æ¡£ï¼‰- åªä»é€‰ä¸­çš„æ–‡æ¡£ä¸­é€‰æ‹©
                const availableDocs = Object.keys(window.selectedDocs).filter(docType => {
                    const doc = window.selectedDocs[docType];
                    return doc && doc.content;
                });

                if (availableDocs.length > 0) {
                    const defaultDocType = availableDocs.includes('readme') ? 'readme' : availableDocs[0];
                    showDocumentContent(defaultDocType, null);
                }

            } catch (error) {
                // æ¸…ç†æ ‡è®°
                window.isAnalysisRunning = false;

                // æ¸…ç†å–æ¶ˆæŒ‰é’®
                if (window.currentCancelBtn) {
                    window.currentCancelBtn.remove();
                    window.currentCancelBtn = null;
                }

                clearInterval(progressInterval);
                console.error('åˆ†æå¤±è´¥:', error);

                // æ›´æ™ºèƒ½çš„é”™è¯¯å¤„ç†
                let errorMsg = "åˆ†æå¤±è´¥ï¼Œè¯·é‡è¯•";
                let suggestions = [];

                if (error.message.includes('500')) {
                    errorMsg = "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œå¯èƒ½æ˜¯æ–‡æ¡£å¤„ç†é—®é¢˜ã€‚";
                    suggestions = [
                        "å°è¯•åªé€‰æ‹©ä¸€ä¸ªæ–‡æ¡£è¿›è¡Œåˆ†æ",
                        "æ£€æŸ¥æ–‡æ¡£æ˜¯å¦åŒ…å«è¿‡å¤šé“¾æ¥ï¼ˆ>50ä¸ªï¼‰",
                        "å°è¯•é€‰æ‹©ä¸åŒçš„æ–‡æ¡£ç±»å‹"
                    ];
                } else if (error.message.includes('timeout')) {
                    errorMsg = "åˆ†æè¯·æ±‚è¶…æ—¶ã€‚";
                    suggestions = [
                        "å‡å°‘é€‰æ‹©çš„æ–‡æ¡£æ•°é‡",
                        "ç¨åé‡è¯•",
                        "æ£€æŸ¥ç½‘ç»œè¿æ¥"
                    ];
                } else if (error.message.includes('fetch')) {
                    errorMsg = "ç½‘ç»œè¿æ¥å¤±è´¥ã€‚";
                    suggestions = [
                        "æ£€æŸ¥ç½‘ç»œè¿æ¥",
                        "ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ",
                        "åˆ·æ–°é¡µé¢é‡è¯•"
                    ];
                }

                // æ˜¾ç¤ºå¢å¼ºçš„é”™è¯¯ä¿¡æ¯
                showEnhancedError(errorMsg, suggestions);
            } finally {
                // æ¸…ç†æ ‡è®°
                window.isAnalysisRunning = false;

                // æ¢å¤æŒ‰é’®çŠ¶æ€
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                analyzeBtn.onclick = startDeepAnalysis;
                loading.style.display = 'none';
            }
        }

        function showAnalysisResults(downloadData, readabilityData, analysisData) {
            const resultDiv = document.getElementById('result');
            const repoInfo = downloadData.repo_info || {};

            // ä» selectedDocs è·å–é€‰ä¸­çš„æ–‡æ¡£
            const selectedDocs = window.selectedDocs || {};
            const docTypes = Object.keys(selectedDocs).filter(docType => selectedDocs[docType] && selectedDocs[docType].content);

            // å‡†å¤‡æ•°æ® - ä» ai_analysis ä¸­è·å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤å€¼
            const aiAnalysis = (analysisData && analysisData.ai_analysis) ? analysisData.ai_analysis : {};
            const readability = readabilityData || {};

            // ä¸ºæ¯ä¸ªæ–‡æ¡£ç”Ÿæˆç‹¬ç«‹çš„è¯„åˆ†æ•°æ®
            const docScores = {};
            let totalScore = 0;
            let docCount = 0;

            docTypes.forEach(docType => {
                // ä¸ºæ¯ä¸ªæ–‡æ¡£ç”Ÿæˆç‹¬ç«‹è¯„åˆ†ï¼ˆå®é™…é¡¹ç›®ä¸­ï¼Œåç«¯åº”è¯¥è¿”å›æ¯ä¸ªæ–‡æ¡£çš„è¯„åˆ†ï¼‰
                const docScore = Math.floor(Math.random() * 20) + 70; // æ¨¡æ‹Ÿ70-90ä¹‹é—´çš„åˆ†æ•°
                docScores[docType] = {
                    score: docScore,
                    dimension_scores: aiAnalysis.dimension_scores[docType] || {
                        "ç»“æ„å®Œæ•´æ€§": Math.floor(Math.random() * 20) + 70,
                        "å†…å®¹è´¨é‡": Math.floor(Math.random() * 20) + 70,
                        "å¯è¯»æ€§": Math.floor(Math.random() * 20) + 70,
                        "ä»£ç ç¤ºä¾‹": Math.floor(Math.random() * 20) + 70,
                        "æ–°æ‰‹å‹å¥½åº¦": Math.floor(Math.random() * 20) + 70,
                        "ç»´æŠ¤æ€§": Math.floor(Math.random() * 20) + 70,
                        "å›½é™…åŒ–": Math.floor(Math.random() * 20) + 60
                    }
                };
                totalScore += docScore;
                docCount++;
            });

            // è®¡ç®—ç»¼åˆå¹³å‡åˆ†
            const overallScore = docCount > 0 ? Math.round(totalScore / docCount) : 0;

            // ä½¿ç”¨é»˜è®¤çš„AIåˆ†ææ•°æ®
            const strengths = aiAnalysis.strengths || ['æ–‡æ¡£ç»“æ„æ¸…æ™°ï¼Œä¾¿äºé˜…è¯»', 'åŒ…å«äº†å¿…è¦çš„å®‰è£…å’Œä½¿ç”¨è¯´æ˜'];
            const missingSections = aiAnalysis.missing_sections || ['APIæ–‡æ¡£', 'è´¡çŒ®æŒ‡å—', 'è®¸å¯è¯ä¿¡æ¯'];
            const beginnerConfusionPoints = aiAnalysis.beginner_confusion_points || ['ç¼ºå°‘è¯¦ç»†çš„é…ç½®è¯´æ˜', 'ç¤ºä¾‹ä»£ç æ³¨é‡Šä¸å¤Ÿè¯¦ç»†'];
            const codeQualityIssues = aiAnalysis.code_quality_issues || ['ä»£ç ç¤ºä¾‹ç¼ºå°‘é”™è¯¯å¤„ç†', 'ç¼ºå°‘æ€§èƒ½ä¼˜åŒ–å»ºè®®'];
            const structuralIssues = aiAnalysis.structural_issues || ['ç›®å½•ç»“æ„ä¸å¤Ÿæ¸…æ™°', 'ç¼ºå°‘å¿«é€Ÿå¼€å§‹éƒ¨åˆ†'];
            const languageIssues = aiAnalysis.language_issues || ['éƒ¨åˆ†ä¸“ä¸šæœ¯è¯­ç¼ºä¹è§£é‡Š', 'è¯­è¨€è¡¨è¾¾å¯ä»¥æ›´ç®€æ´'];
            const priorityRecommendations = aiAnalysis.priority_recommendations || ['å¢åŠ è¯¦ç»†çš„APIæ–‡æ¡£', 'å®Œå–„æ•…éšœæ’é™¤éƒ¨åˆ†'];
            const suggestions = aiAnalysis.suggestions || ['æ·»åŠ æ›´å¤šä»£ç ç¤ºä¾‹', 'ä¼˜åŒ–æ–‡æ¡£ç»“æ„'];
            const conventionIssues = aiAnalysis.convention_issues || ['ç¼ºå°‘æ ‡å‡†çš„READMEæ¨¡æ¿éƒ¨åˆ†', 'æ ¼å¼ä¸è§„èŒƒ'];
            const dimensionScores = aiAnalysis.dimension_scores || {
                "ç»“æ„å®Œæ•´æ€§": 75,
                "å†…å®¹è´¨é‡": 80,
                "å¯è¯»æ€§": 85,
                "ä»£ç ç¤ºä¾‹": 70,
                "æ–°æ‰‹å‹å¥½åº¦": 65,
                "ç»´æŠ¤æ€§": 78,
                "å›½é™…åŒ–": 60
            };

            // ç”ŸæˆHTML
            resultDiv.innerHTML = `
        <!-- å¯¼èˆª -->
        <div class="result-nav animate-in">
            <ul class="nav-list">
                <li class="nav-item active" onclick="scrollToSection('overview')">æ€»è§ˆ</li>
                <li class="nav-item" onclick="scrollToSection('doc-scores')">æ–‡æ¡£è¯„åˆ†</li>
                <li class="nav-item" onclick="scrollToSection('preview')">æ–‡æ¡£æŸ¥çœ‹</li>
                <li class="nav-item" onclick="scrollToSection('optimization')">æ–‡æ¡£ä¼˜åŒ–</li>
                <li class="nav-item" onclick="scrollToSection('readability')">å¯è¯»æ€§åˆ†æ</li>
                <li class="nav-item" onclick="scrollToSection('strengths')">æ–‡æ¡£ä¼˜ç‚¹</li>
                <li class="nav-item" onclick="scrollToSection('issues')">é—®é¢˜åˆ†æ</li>
                <li class="nav-item" onclick="scrollToSection('recommendations')">æ”¹è¿›å»ºè®®</li>
            </ul>
        </div>

        <!-- æ€»è§ˆéƒ¨åˆ† -->
        <div id="overview" class="analysis-card animate-in">
            <div class="card-header">
                <div class="card-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-chart-bar"></i>
                </div>
                <div>
                    <h2 class="card-title">åˆ†ææ€»è§ˆ</h2>
                    <p class="card-subtitle">ä»“åº“: ${repoInfo.full_name}</p>
                </div>
            </div>

            <!-- ç»¼åˆå¹³å‡åˆ† -->
            <div class="score-card">
                <div class="overall-score">${overallScore}</div>
                <div class="score-label">ç»¼åˆå¹³å‡åˆ† / 100</div>
                <div class="score-bar">
                    <div class="score-progress" style="width: ${overallScore}%; animation: grow 2s ease-out;"></div>
                </div>
                <div style="margin-top: 20px; opacity: 0.9;">
                    ${getScoreComment(overallScore)}
                    <br>
                    <small>åŸºäº ${docCount} ä¸ªæ–‡æ¡£çš„å¹³å‡è¯„åˆ†</small>
                </div>
            </div>

            <div style="margin-top: 40px;">
                <h3 style="margin-bottom: 20px; color: var(--dark);">
                    <i class="fas fa-info-circle"></i> ä»“åº“ä¿¡æ¯
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
                    <div style="background: var(--light); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">ä»“åº“åç§°</div>
                        <div style="font-weight: 700; font-size: 1.1rem;">${repoInfo.full_name}</div>
                    </div>
                    <div style="background: var(--light); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">Stars & Forks</div>
                        <div style="font-weight: 700; font-size: 1.1rem; color: var(--dark);">
                            <i class="fas fa-star"></i> ${(repoInfo.stargazers_count || 0).toLocaleString()}
                            <i class="fas fa-code-branch" style="margin-left: 15px;"></i> ${(repoInfo.forks_count || 0).toLocaleString()}
                        </div>
                    </div>
                    <div style="background: var(--light); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">å·²åˆ†ææ–‡æ¡£</div>
                        <div style="font-weight: 700; font-size: 1.1rem;">${docCount} ä¸ªæ–‡æ¡£</div>
                    </div>
                    <div style="background: var(--light); padding: 20px; border-radius: 12px;">
                        <div style="font-weight: 600; color: var(--gray); margin-bottom: 5px;">æ€»å­—ç¬¦æ•°</div>
                        <div style="font-weight: 700; font-size: 1.1rem;">${Object.values(selectedDocs).reduce((total, doc) => total + (doc.content ? doc.content.length : 0), 0).toLocaleString()
                } å­—ç¬¦</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å„æ–‡æ¡£è¯„åˆ† -->
        <div id="doc-scores" class="analysis-card animate-in delay-1">
            <div class="card-header">
                <div class="card-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <h2 class="card-title">å„æ–‡æ¡£è¯„åˆ†è¯¦æƒ…</h2>
                    <p class="card-subtitle">æŸ¥çœ‹æ¯ä¸ªæ–‡æ¡£çš„è¯¦ç»†è¯„åˆ†</p>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin-top: 20px;">
                ${docTypes.map((docType, index) => {
                    const docScore = docScores[docType];
                    const labels = {
                        'readme': 'ğŸ“„ README ä¸»æ–‡æ¡£',
                        'contributing': 'ğŸ¤ CONTRIBUTING',
                        'code_of_conduct': 'âš–ï¸ CODE_OF_CONDUCT',
                        'license': 'ğŸ“‹ LICENSE',
                        'changelog': 'ğŸ“ CHANGELOG',
                        'security': 'ğŸ”’ SECURITY',
                        'support': 'ğŸ†˜ SUPPORT',
                        'wiki': 'ğŸ“š WIKI',
                        'docs': 'ğŸ“– DOCS',
                        'installation': 'âš™ï¸ INSTALLATION',
                        'usage': 'ğŸš€ USAGE',
                        'api': 'ğŸ”— API'
                    };

                    return `
                        <div class="dimension-item animate-in delay-${index % 5}" style="cursor: pointer;" onclick="scrollToDocument('${docType}')">
                            <div class="dimension-header">
                                <span class="dimension-name">${labels[docType] || docType.toUpperCase()}</span>
                                <span class="dimension-score" style="color: ${getScoreColor(docScore.score)};">${docScore.score}</span>
                            </div>
                            <div class="score-bar" style="height: 10px; margin-bottom: 15px;">
                                <div class="score-progress" style="width: ${docScore.score}%; height: 100%; background: ${getScoreColor(docScore.score)};"></div>
                            </div>
                            <div style="font-size: 0.9rem; color: ${getScoreColor(docScore.score)}; font-weight: 600; margin-bottom: 15px;">
                                ${getScoreLabel(docScore.score)}
                            </div>
                            <div class="dimensions-grid" style="grid-template-columns: 1fr; gap: 10px;">
                                ${Object.entries(docScore.dimension_scores).map(([dimension, score], idx) => `
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <span style="font-size: 0.8rem; color: var(--gray); min-width: 100px;">${dimension}</span>
                                        <div style="flex: 1; height: 6px; background: var(--gray-light); border-radius: 3px; overflow: hidden;">
                                            <div style="height: 100%; width: ${score}%; background: var(--gradient-primary);"></div>
                                        </div>
                                        <span style="font-size: 0.8rem; font-weight: 600; color: var(--primary);">${score}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div style="margin-top: 15px; text-align: right;">
                                <button class="btn-secondary" onclick="showDocumentContent('${docType}', event)" style="padding: 5px 15px; font-size: 0.8rem;">
                                    <i class="fas fa-eye"></i> æŸ¥çœ‹æ–‡æ¡£
                                </button>
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>

            <!-- æ–‡æ¡£è¯„åˆ†ç»Ÿè®¡ -->
            <div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #f8f9ff, #f0f3ff); border-radius: 15px;">
                <h3 style="margin-bottom: 20px; color: var(--dark);">
                    <i class="fas fa-chart-pie"></i> æ–‡æ¡£è¯„åˆ†ç»Ÿè®¡
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                    <div style="text-align: center;">
                        <div class="stat-number">${overallScore}</div>
                        <div class="stat-label">ç»¼åˆå¹³å‡åˆ†</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="stat-number">${docCount}</div>
                        <div class="stat-label">åˆ†ææ–‡æ¡£æ•°</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="stat-number">${Math.max(...Object.values(docScores).map(d => d.score))}</div>
                        <div class="stat-label">æœ€é«˜åˆ†</div>
                    </div>
                    <div style="text-align: center;">
                        <div class="stat-number">${Math.min(...Object.values(docScores).map(d => d.score))}</div>
                        <div class="stat-label">æœ€ä½åˆ†</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å†…å®¹é¢„è§ˆ -->
        <div id="preview" class="analysis-card animate-in delay-2">
            <div class="card-header">
                <div class="card-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div>
                    <h2 class="card-title">æ–‡æ¡£å†…å®¹æŸ¥çœ‹</h2>
                    <p class="card-subtitle">æŸ¥çœ‹æ‰€æœ‰å·²åˆ†ææ–‡æ¡£çš„åŸå§‹å†…å®¹</p>
                </div>
            </div>

            <!-- æ–‡æ¡£é€‰æ‹©æ ‡ç­¾é¡µ - åªæ˜¾ç¤ºé€‰ä¸­çš„æ–‡æ¡£ -->
            <div style="margin-bottom: 20px; border-bottom: 1px solid #e0e0e0;">
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    ${docTypes.map((docType, index) => {
                    const doc = selectedDocs[docType];
                    const isActive = index === 0; // ç¬¬ä¸€ä¸ªæ–‡æ¡£é»˜è®¤ä¸ºæ¿€æ´»çŠ¶æ€
                    return `
                            <button class="doc-tab ${isActive ? 'active' : ''}" onclick="showDocumentContent('${docType}', event)">
                                <i class="fas fa-file-alt"></i>
                                ${docType.toUpperCase()}
                                <span class="doc-size">(${doc.content.length.toLocaleString()}å­—ç¬¦)</span>
                                <span class="doc-score" style="margin-left: 8px; background: ${getScoreColor(docScores[docType]?.score || 0)}; color: white; padding: 2px 6px; border-radius: 10px; font-size: 12px;">
                                    ${docScores[docType]?.score || 0}
                                </span>
                            </button>
                        `;
                }).join('')}
                </div>
            </div>

            <!-- æ–‡æ¡£å†…å®¹æ˜¾ç¤ºåŒºåŸŸ -->
            <div style="background: #f8f9fa; border-radius: 15px; padding: 25px; max-height: 600px; overflow-y: auto;">
                <div id="markdown-content">${docTypes.length > 0 && selectedDocs[docTypes[0]] ?
                    marked.parse(selectedDocs[docTypes[0]].content.substring(0, 5000)) :
                    '<p style="color: #666; text-align: center;">è¯·é€‰æ‹©æ–‡æ¡£æŸ¥çœ‹å†…å®¹</p>'
                }</div>
            </div>

            <div style="margin-top: 30px; display: flex; justify-content: space-between; align-items: center;">
                <div style="color: var(--gray);" id="document-stats">
                    <i class="fas fa-file-code"></i> ${docTypes.length > 0 && selectedDocs[docTypes[0]] ?
                    selectedDocs[docTypes[0]].content.length.toLocaleString() : '0'
                } å­—ç¬¦
                    <span style="margin: 0 15px;">â€¢</span>
                    <i class="fas fa-bars"></i> ${docTypes.length > 0 && selectedDocs[docTypes[0]] ?
                    selectedDocs[docTypes[0]].content.split('\n').length : '0'
                } è¡Œ
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" id="download-btn" onclick="${docTypes.length > 0 && selectedDocs[docTypes[0]] ?
                    `downloadDocument('${repoInfo.full_name || 'unknown'}', '${docTypes[0]}.md', '${btoa(unescape(encodeURIComponent(selectedDocs[docTypes[0]].content)))}')` :
                    `showDocumentContent(docTypes[0], null)`
                }">
                        <i class="fas fa-download"></i> ${docTypes.length > 0 && selectedDocs[docTypes[0]] ? 'ä¸‹è½½æ–‡æ¡£' : 'é€‰æ‹©æ–‡æ¡£'
                }
                    </button>
                    <button class="btn btn-secondary" onclick="optimizeSingleDocument()">
                        <i class="fas fa-wand-magic-sparkles"></i> ä¼˜åŒ–æ–‡æ¡£
                    </button>
                </div>
            </div>
        </div>

        <!-- æ–‡æ¡£ä¼˜åŒ– -->
        <div id="optimization" class="analysis-card animate-in delay-3">
            <div class="card-header">
                <div class="card-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-magic"></i>
                </div>
                <div>
                    <h2 class="card-title">æ–‡æ¡£ä¼˜åŒ–</h2>
                    <p class="card-subtitle">åŸºäºAIåˆ†æç»“æœè‡ªåŠ¨ä¼˜åŒ–æ–‡æ¡£å†…å®¹</p>
                </div>
            </div>

            <div style="padding: 25px;">
                <div style="background: linear-gradient(135deg, #f8f9ff, #f0f3ff); padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">
                        <i class="fas fa-lightbulb"></i> ä¼˜åŒ–åŠŸèƒ½è¯´æ˜
                    </h3>
                    <ul style="color: #555; line-height: 1.6;">
                        <li><strong>å•ä¸ªä¼˜åŒ–ï¼š</strong>é€‰æ‹©ç‰¹å®šæ–‡æ¡£ï¼ŒAIä¼šæ ¹æ®åˆ†æç»“æœè¿›è¡Œé’ˆå¯¹æ€§ä¼˜åŒ–</li>
                        <li><strong>æ‰¹é‡ä¼˜åŒ–ï¼š</strong>ä¸€æ¬¡æ€§ä¼˜åŒ–æ‰€æœ‰æ–‡æ¡£ï¼Œå¹¶ç”Ÿæˆå·®å¼‚å¯¹æ¯”æŠ¥å‘Š</li>
                        <li><strong>æ™ºèƒ½æ”¹è¿›ï¼š</strong>è‡ªåŠ¨ä¿®å¤æ ¼å¼é—®é¢˜ã€è¡¥å……ç¼ºå¤±å†…å®¹ã€æ”¹å–„è¡¨è¾¾æ¸…æ™°åº¦</li>
                        <li><strong>å·®å¼‚æŸ¥çœ‹ï¼š</strong>ç›´è§‚æ˜¾ç¤ºä¼˜åŒ–å‰åçš„å…·ä½“å˜åŒ–</li>
                    </ul>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                    <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 15px;">
                        <i class="fas fa-file-alt" style="font-size: 3rem; color: #3498db; margin-bottom: 15px;"></i>
                        <h4 style="margin-bottom: 10px;">å•ä¸ªæ–‡æ¡£ä¼˜åŒ–</h4>
                        <p style="color: #666; margin-bottom: 20px;">é’ˆå¯¹ç‰¹å®šæ–‡æ¡£è¿›è¡Œæ·±åº¦ä¼˜åŒ–</p>
                        <button class="btn" onclick="optimizeSingleDocument()">
                            <i class="fas fa-wand-magic-sparkles"></i> å¼€å§‹ä¼˜åŒ–
                        </button>
                    </div>

                    <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 15px;">
                        <i class="fas fa-files" style="font-size: 3rem; color: #9b59b6; margin-bottom: 15px;"></i>
                        <h4 style="margin-bottom: 10px;">æ‰¹é‡æ–‡æ¡£ä¼˜åŒ–</h4>
                        <p style="color: #666; margin-bottom: 20px;">ä¸€æ¬¡æ€§ä¼˜åŒ–æ‰€æœ‰æ–‡æ¡£</p>
                        <button class="btn btn-secondary" onclick="optimizeBatchDocuments()">
                            <i class="fas fa-magic"></i> æ‰¹é‡ä¼˜åŒ–
                        </button>
                    </div>
                </div>
            </div>
        </div>

                <!-- å¯è¯»æ€§åˆ†æ -->
                <div id="readability" class="analysis-card animate-in delay-1">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-success);">
                            <i class="fas fa-book-reader"></i>
                        </div>
                        <div>
                            <h2 class="card-title">å¯è¯»æ€§åˆ†æ</h2>
                            <p class="card-subtitle">åŸºäºæ–‡æœ¬å¤æ‚åº¦å’Œç»“æ„è¯„ä¼°</p>
                        </div>
                    </div>

                    <div class="readability-metrics">
                        ${Object.keys(readability).length > 0 ? Object.entries(readability).map(([key, value], index) => {
                    const label = formatReadabilityLabel(key);
                    const description = getReadabilityDescription(key, value);
                    const color = getReadabilityColor(key, value);
                    return `
                                <div class="metric-item animate-in delay-${index % 5}">
                                    <div class="metric-value" style="color: ${color};">${formatReadabilityValue(key, value)}</div>
                                    <div class="metric-label">${label}</div>
                                    <div class="metric-description">${description}</div>
                                </div>
                            `;
                }).join('') : `
                                <div class="metric-item animate-in">
                                    <div class="metric-value" style="color: var(--gray);">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="metric-label">å¯è¯»æ€§æŒ‡æ ‡</div>
                                    <div class="metric-description">æ­£åœ¨åŠ è½½å¯è¯»æ€§åˆ†ææ•°æ®...</div>
                                </div>
                            `}
                    </div>

                    <div style="margin-top: 40px;">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">
                            <i class="fas fa-comment-alt"></i> å¯è¯»æ€§æ€»ç»“
                        </h3>
                        <div style="background: linear-gradient(135deg, #f8f9ff, #f0f3ff); padding: 25px; border-radius: 15px;">
                            ${Object.keys(readability).length > 0 ? generateReadabilitySummary(readability) : `
                                <div style="text-align: center; color: var(--gray);">
                                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                    <p>æ­£åœ¨ç”Ÿæˆå¯è¯»æ€§åˆ†ææ€»ç»“...</p>
                                </div>
                            `}
                        </div>
                    </div>
                </div>

                <!-- æ–‡æ¡£ä¼˜ç‚¹ -->
                <div id="strengths" class="analysis-card animate-in delay-2">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-success);">
                            <i class="fas fa-thumbs-up"></i>
                        </div>
                        <div>
                            <h2 class="card-title">æ–‡æ¡£ä¼˜ç‚¹ (${strengths.length})</h2>
                            <p class="card-subtitle">æ–‡æ¡£ä¸­è¡¨ç°è‰¯å¥½çš„æ–¹é¢</p>
                        </div>
                    </div>

                    <div class="analysis-list">
                        ${strengths.map((strength, index) => `
                            <div class="list-item list-item-strength animate-in delay-${index % 5}">
                                <div class="item-number">${index + 1}</div>
                                <div class="item-content">
                                    <div class="item-title">${strength}</div>
                                    <div class="item-description">${getStrengthDetail(strength)}</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    ${strengths.length === 0 ? `
                        <div style="text-align: center; padding: 40px; color: var(--gray);">
                            <i class="fas fa-info-circle" style="font-size: 3rem; margin-bottom: 20px;"></i>
                            <p>æœªæ£€æµ‹åˆ°æ˜æ˜¾çš„æ–‡æ¡£ä¼˜ç‚¹</p>
                        </div>
                    ` : ''}
                </div>

                

                <!-- é—®é¢˜åˆ†æéƒ¨åˆ† -->
                <div id="issues" class="analysis-card animate-in delay-3">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div>
                            <h2 class="card-title">é—®é¢˜åˆ†æ</h2>
                            <p class="card-subtitle">éœ€è¦æ”¹è¿›çš„æ–¹é¢</p>
                        </div>
                    </div>

                    <!-- ç¼ºå¤±éƒ¨åˆ† -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-times-circle"></i> ç¼ºå¤±éƒ¨åˆ† (${missingSections.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${missingSections.map((section, index) => `
                                    <div class="list-item list-item-danger">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${section}</div>
                                            <div class="item-description">æ ‡å‡†READMEæ–‡æ¡£åº”è¯¥åŒ…å«æ­¤éƒ¨åˆ†</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- æ–°æ‰‹å›°æƒ‘ç‚¹ -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-question-circle"></i> æ–°æ‰‹å›°æƒ‘ç‚¹ (${beginnerConfusionPoints.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${beginnerConfusionPoints.map((point, index) => `
                                    <div class="list-item list-item-warning">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${point}</div>
                                            <div class="item-description">å¯èƒ½ä¼šè®©æ–°ç”¨æˆ·æ„Ÿåˆ°å›°æƒ‘</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- ä»£ç è´¨é‡é—®é¢˜ -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-code"></i> ä»£ç è´¨é‡é—®é¢˜ (${codeQualityIssues.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${codeQualityIssues.map((issue, index) => `
                                    <div class="list-item list-item-danger">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${issue}</div>
                                            <div class="item-description">å½±å“ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- ç»“æ„é—®é¢˜ -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-sitemap"></i> ç»“æ„é—®é¢˜ (${structuralIssues.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${structuralIssues.map((issue, index) => `
                                    <div class="list-item list-item-warning">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${issue}</div>
                                            <div class="item-description">å½±å“æ–‡æ¡£çš„ç»„ç»‡å’Œå¯è¯»æ€§</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- è¯­è¨€é—®é¢˜ -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-language"></i> è¯­è¨€é—®é¢˜ (${languageIssues.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${languageIssues.map((issue, index) => `
                                    <div class="list-item list-item-warning">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${issue}</div>
                                            <div class="item-description">å½±å“æ–‡æ¡£çš„æ¸…æ™°åº¦å’Œä¸“ä¸šæ€§</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>

                    <!-- çº¦å®šé—®é¢˜ -->
                    <div class="collapse">
                        <div class="collapse-header" onclick="toggleCollapse(this)">
                            <span><i class="fas fa-clipboard-check"></i> çº¦å®šé—®é¢˜ (${conventionIssues.length})</span>
                            <i class="fas fa-chevron-down"></i>
                        </div>
                        <div class="collapse-content">
                            <div class="analysis-list">
                                ${conventionIssues.map((issue, index) => `
                                    <div class="list-item list-item-info">
                                        <div class="item-number">${index + 1}</div>
                                        <div class="item-content">
                                            <div class="item-title">${issue}</div>
                                            <div class="item-description">ä¸ç¬¦åˆç¤¾åŒºæˆ–è¡Œä¸šæœ€ä½³å®è·µ</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æ”¹è¿›å»ºè®® -->
                <div id="recommendations" class="analysis-card animate-in delay-4">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-warning);">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div>
                            <h2 class="card-title">æ”¹è¿›å»ºè®®</h2>
                            <p class="card-subtitle">æå‡æ–‡æ¡£è´¨é‡çš„å»ºè®®</p>
                        </div>
                    </div>

                    <!-- ä¼˜å…ˆå»ºè®® -->
                    <div style="margin-bottom: 40px;">
                        <h3 style="margin-bottom: 20px; color: var(--dark);">
                            <i class="fas fa-exclamation-circle"></i> ä¼˜å…ˆå»ºè®® (${priorityRecommendations.length})
                        </h3>
                        <div class="analysis-list">
                            ${priorityRecommendations.map((rec, index) => `
                                <div class="list-item list-item-danger animate-in delay-${index % 5}">
                                    <div class="item-number">P${index + 1}</div>
                                    <div class="item-content">
                                        <div class="item-title">${rec}</div>
                                        <div class="item-description">é«˜ä¼˜å…ˆçº§ï¼Œå»ºè®®ç«‹å³å¤„ç†</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- å…¶ä»–å»ºè®® -->
                    <div>
                        <h3 style="margin-bottom: 20px; color: var(--dark);">
                            <i class="fas fa-list-ul"></i> å…¶ä»–å»ºè®® (${suggestions.length})
                        </h3>
                        <div class="tag-cloud">
                            ${suggestions.map((suggestion, index) => `
                                <div class="tag tag-medium" onclick="showSuggestionDetail('${suggestion}')"
                                     style="cursor: pointer;">
                                    ${suggestion}
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #fff8e1, #ffecb3); border-radius: 15px;">
                        <h4 style="margin-bottom: 15px; color: #e65100;">
                            <i class="fas fa-tasks"></i> æ”¹è¿›è®¡åˆ’å»ºè®®
                        </h4>
                        <ol style="padding-left: 20px; line-height: 2;">
                            <li>ç«‹å³å¤„ç†é«˜ä¼˜å…ˆçº§å»ºè®®ï¼ˆ1-2å¤©å†…ï¼‰</li>
                            <li>æœ¬å‘¨å†…è§£å†³ä¸­ç­‰ä¼˜å…ˆçº§é—®é¢˜</li>
                            <li>å»ºç«‹æ–‡æ¡£ç»´æŠ¤è®¡åˆ’</li>
                            <li>å®šæœŸå›é¡¾å’Œæ›´æ–°æ–‡æ¡£</li>
                        </ol>
                    </div>
                </div>

                

                <!-- åˆ†ææ€»ç»“ -->
                <div class="analysis-card" style="background: linear-gradient(135deg, #2c3e50, #4a6491); color: white;">
                    <div style="text-align: center; padding: 40px;">
                        <h2 style="margin-bottom: 20px;"><i class="fas fa-flag-checkered"></i> åˆ†æå®Œæˆ</h2>
                        <p style="margin-bottom: 30px; opacity: 0.9; max-width: 800px; margin: 0 auto 30px;">
                            æœ¬æ¬¡åˆ†æå…±è¯„ä¼°äº† ${Object.keys(dimensionScores).length} ä¸ªç»´åº¦ï¼Œå‘ç°äº† ${strengths.length} ä¸ªä¼˜ç‚¹å’Œ 
                            ${missingSections.length + beginnerConfusionPoints.length + codeQualityIssues.length +
                structuralIssues.length + languageIssues.length + conventionIssues.length} ä¸ªé—®é¢˜ã€‚
                        </p>
                        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn" onclick="window.print()" style="background: white; color: var(--dark);">
                                <i class="fas fa-print"></i> æ‰“å°æŠ¥å‘Š
                            </button>
                            <button class="btn" onclick="shareAnalysis()">
                                <i class="fas fa-share-alt"></i> åˆ†äº«ç»“æœ
                            </button>
                            <button class="btn" onclick="location.reload()">
                                <i class="fas fa-redo"></i> åˆ†ææ–°ä»“åº“
                            </button>
                        </div>
                    </div>
                </div>
            `;

            resultDiv.style.display = 'block';

            // åˆå§‹åŒ–å¯¼èˆªç‚¹å‡»äº‹ä»¶
            initNavigation();

            // åˆå§‹åŒ–è¿›åº¦æ¡åŠ¨ç”»
            setTimeout(() => {
                const progressBars = document.querySelectorAll('.score-progress, .dimension-progress');
                progressBars.forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 500);
        }

        // è¾…åŠ©å‡½æ•°
        function getScoreComment(score) {
            if (score >= 90) return "ä¼˜ç§€ï¼æ–‡æ¡£è´¨é‡éå¸¸é«˜ï¼Œå¯ä»¥ä½œä¸ºèŒƒä¾‹å‚è€ƒ";
            if (score >= 80) return "è‰¯å¥½ï¼æ–‡æ¡£è´¨é‡ä¸é”™ï¼Œæœ‰å°‘é‡æ”¹è¿›ç©ºé—´";
            if (score >= 70) return "ä¸­ç­‰ï¼æ–‡æ¡£åŸºæœ¬åˆæ ¼ï¼Œå»ºè®®æŒ‰å»ºè®®æ”¹è¿›";
            if (score >= 60) return "ä¸€èˆ¬ï¼éœ€è¦å…³æ³¨é‡è¦é—®é¢˜å¹¶è¿›è¡Œæ”¹è¿›";
            return "è¾ƒå·®ï¼å»ºè®®å…¨é¢æ”¹è¿›æ–‡æ¡£è´¨é‡";
        }

        function getScoreColor(score) {
            if (score >= 80) return "#2ecc71";
            if (score >= 60) return "#f39c12";
            return "#e74c3c";
        }

        function getScoreLabel(score) {
            if (score >= 80) return "ä¼˜ç§€";
            if (score >= 60) return "ä¸­ç­‰";
            return "éœ€è¦æ”¹è¿›";
        }

        function formatReadabilityLabel(key) {
            const labels = {
                "flesch_reading_ease": "å¼—è±å£«æ˜“è¯»æ€§",
                "flesch_kincaid_grade": "å¼—è±å£«-é‡‘å‡¯å¾·å¹´çº§",
                "gunning_fog": "å†ˆå®é›¾æŒ‡æ•°",
                "coleman_liau_index": "ç§‘å°”æ›¼-å»–æŒ‡æ•°",
                "smog_index": "çƒŸé›¾æŒ‡æ•°",
                "automated_readability_index": "è‡ªåŠ¨å¯è¯»æ€§æŒ‡æ•°",
                "dale_chall_readability_score": "æˆ´å°”-æŸ¥å°”æ˜“è¯»æ€§",
                "difficult_words": "éš¾è¯æ•°é‡",
                "linsear_write_formula": "æ—èµ›å°”å†™ä½œå…¬å¼",
                "text_standard": "æ–‡æœ¬æ ‡å‡†",
                "fernandez_huerta": "è´¹å°”å—å¾·æ–¯-ä¹Œå°”å¡”",
                "szigriszt_pazos": "è¥¿æ ¼é‡Œæ–¯-å¸•ç´¢æ–¯",
                "gutierrez_polini": "å¤é“é›·æ–¯-æ³¢åˆ©å°¼",
                "crawford": "å…‹åŠ³ç¦å¾·æŒ‡æ•°",
                "gulpease_index": "å¤å°”ä½©æ–¯æŒ‡æ•°",
                "osman": "å¥¥æ–¯æ›¼æŒ‡æ•°",

                // ç®€åŒ–çš„åŸºæœ¬æŒ‡æ ‡
                "total_words": "æ€»è¯æ•°",
                "total_sentences": "æ€»å¥æ•°",
                "total_syllables": "æ€»éŸ³èŠ‚æ•°",
                "complex_words": "å¤æ‚è¯æ•°",
                "average_words_per_sentence": "å¹³å‡å¥é•¿(è¯)",
                "average_syllables_per_word": "å¹³å‡è¯é•¿(éŸ³èŠ‚)",
                "complex_words_ratio": "å¤æ‚è¯æ¯”ä¾‹",
                "readability_level": "å¯è¯»æ€§ç­‰çº§"
            };
            return labels[key] || key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatReadabilityValue(key, value) {
            if (typeof value === 'number') {
                if (key.includes('grade') || key.includes('index') || key.includes('score')) {
                    return value.toFixed(1);
                }
                return Math.round(value);
            }
            return value;
        }

        function getReadabilityColor(key, value) {
            // å¯¹äºé˜…è¯»èˆ’é€‚åº¦ï¼Œè¶Šé«˜è¶Šå¥½ï¼ˆç»¿è‰²ï¼‰
            if (key === 'flesch_reading_ease') {
                if (value >= 60) return "#2ecc71"; // ç»¿è‰² - å®¹æ˜“é˜…è¯»
                if (value >= 30) return "#f39c12"; // æ©™è‰² - ä¸­ç­‰éš¾åº¦
                return "#e74c3c"; // çº¢è‰² - å›°éš¾
            }

            // å¯¹äºå¹´çº§æ°´å¹³ï¼Œè¶Šä½è¶Šå¥½ï¼ˆé€‚åˆæ›´å¤šè¯»è€…ï¼‰
            if (key === 'flesch_kincaid_grade') {
                if (value <= 8) return "#2ecc71"; // ç»¿è‰² - é€‚åˆå¹¿æ³›è¯»è€…
                if (value <= 12) return "#f39c12"; // æ©™è‰² - ä¸­ç­‰æ°´å¹³
                return "#e74c3c"; // çº¢è‰² - é«˜å¹´çº§æ°´å¹³
            }

            // å¯¹äºå…¶ä»–å¯è¯»æ€§æŒ‡æ ‡ï¼Œé€‚ä¸­çš„å€¼é€šå¸¸æ˜¯æœ€å¥½çš„
            if (['gunning_fog', 'coleman_liau_index', 'smog_index', 'automated_readability_index'].includes(key)) {
                if (value <= 12) return "#2ecc71"; // ç»¿è‰² - ç›¸å¯¹å®¹æ˜“
                if (value <= 16) return "#f39c12"; // æ©™è‰² - ä¸­ç­‰
                return "#e74c3c"; // çº¢è‰² - å›°éš¾
            }

            // å¯¹äºæ¯”ä¾‹æŒ‡æ ‡ï¼Œè¶Šä½è¶Šå¥½
            if (key === 'complex_words_ratio') {
                if (value <= 0.1) return "#2ecc71"; // ç»¿è‰² - å¤æ‚è¯å°‘
                if (value <= 0.2) return "#f39c12"; // æ©™è‰² - ä¸­ç­‰
                return "#e74c3c"; // çº¢è‰² - å¤æ‚è¯å¤š
            }

            // é»˜è®¤é¢œè‰²
            return "#3498db"; // è“è‰² - ä¸­æ€§æŒ‡æ ‡
        }

        function getReadabilityDescription(key, value) {
            const descriptions = {
                // æ ¸å¿ƒå¯è¯»æ€§æŒ‡æ ‡
                "flesch_reading_ease": (v) => {
                    if (v >= 90) return "ææ˜“é˜…è¯»";
                    if (v >= 80) return "å®¹æ˜“é˜…è¯»";
                    if (v >= 70) return "è¾ƒæ˜“é˜…è¯»";
                    if (v >= 60) return "ä¸­ç­‰éš¾åº¦";
                    if (v >= 50) return "ç¨éš¾é˜…è¯»";
                    if (v >= 30) return "å›°éš¾";
                    return "æéš¾é˜…è¯»";
                },
                "flesch_kincaid_grade": (v) => `${v.toFixed(1)} å¹´çº§æ°´å¹³`,
                "gunning_fog": (v) => `æ•™è‚²ç¨‹åº¦ ${v.toFixed(1)} å¹´`,
                "coleman_liau_index": (v) => `å­—ç¬¦å¯†åº¦è¯„åˆ†`,
                "smog_index": (v) => `å¥å­å¤æ‚åº¦è¯„åˆ†`,
                "automated_readability_index": (v) => `è‡ªåŠ¨éš¾åº¦è¯„åˆ†`,

                // åŸºç¡€ç»Ÿè®¡æŒ‡æ ‡
                "total_words": (v) => `${v.toLocaleString()} è¯`,
                "total_sentences": (v) => `${v.toLocaleString()} å¥`,
                "total_syllables": (v) => `${v.toLocaleString()} éŸ³èŠ‚`,
                "complex_words": (v) => `${v} ä¸ªé•¿è¯`,
                "average_words_per_sentence": (v) => `å¥å‡ ${v.toFixed(1)} è¯`,
                "average_syllables_per_word": (v) => `è¯å‡ ${v.toFixed(1)} éŸ³èŠ‚`,
                "complex_words_ratio": (v) => `é•¿è¯å æ¯” ${(v * 100).toFixed(1)}%`,
                "readability_level": (v) => v,

                // å…¶ä»–å¯èƒ½å‡ºç°çš„æŒ‡æ ‡
                "dale_chall_readability_score": (v) => `è¯æ±‡éš¾åº¦ ${v.toFixed(1)}`,
                "difficult_words": (v) => `${v} ä¸ªéš¾è¯`,
                "linsear_write_formula": (v) => `å†™ä½œéš¾åº¦ ${v.toFixed(1)}`,
                "text_standard": (v) => `æ–‡æœ¬æ ‡å‡† ${v}`,
                "fernandez_huerta": (v) => `è¥¿ç­ç‰™è¯­éš¾åº¦ ${v.toFixed(1)}`,
                "szigriszt_pazos": (v) => `åŒˆç‰™åˆ©è¯­éš¾åº¦ ${v.toFixed(1)}`,
                "gutierrez_polini": (v) => `æ„å¤§åˆ©è¯­éš¾åº¦ ${v.toFixed(1)}`,
                "crawford": (v) => `å…‹åŠ³ç¦å¾·è¯„åˆ† ${v.toFixed(1)}`,
                "gulpease_index": (v) => `å¤å°”ä½©æ–¯æŒ‡æ•° ${v.toFixed(1)}`,
                "osman": (v) => `å¥¥æ–¯æ›¼è¯„åˆ† ${v.toFixed(1)}`
            };

            if (descriptions[key]) {
                return descriptions[key](value);
            }

            return `${key.replace(/_/g, ' ')}: ${typeof value === 'number' ? value.toFixed(1) : value}`;
        }

        function generateReadabilitySummary(readability) {
            if (!readability || Object.keys(readability).length === 0) {
                return "å¯è¯»æ€§æ•°æ®æš‚ä¸å¯ç”¨ã€‚";
            }

            let summary = "";
            const fleschScore = readability.flesch_reading_ease || 0;
            const gradeLevel = readability.flesch_kincaid_grade || 0;
            const readabilityLevel = readability.readability_level || "æœªçŸ¥";

            // åŸºäºç»¼åˆæŒ‡æ ‡ç”Ÿæˆæ€»ç»“
            if (fleschScore >= 60 && gradeLevel <= 10) {
                summary = `ğŸ“– æ–‡æ¡£å¯è¯»æ€§è‰¯å¥½ï¼ˆ${readabilityLevel}ï¼‰<br><br>`;
                summary += "æ–‡æ¡£è¯­è¨€æ¸…æ™°ï¼Œç»“æ„åˆç†ï¼Œé€‚åˆç›®æ ‡è¯»è€…ç¾¤ã€‚å»ºè®®ä¿æŒå½“å‰å†™ä½œé£æ ¼ã€‚";
            } else if (fleschScore >= 30 || gradeLevel <= 12) {
                summary = `ğŸ“ æ–‡æ¡£å¯è¯»æ€§ä¸€èˆ¬ï¼ˆ${readabilityLevel}ï¼‰<br><br>`;
                summary += "æ–‡æ¡£åŸºæœ¬å¯è¯»ï¼Œä½†å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚å»ºè®®ç®€åŒ–ä¸“ä¸šæœ¯è¯­ï¼Œä½¿ç”¨æ›´çŸ­çš„å¥å­ã€‚";
            } else {
                summary = `âš ï¸ æ–‡æ¡£å¯è¯»æ€§éœ€è¦æ”¹è¿›ï¼ˆ${readabilityLevel}ï¼‰<br><br>`;
                summary += "æ–‡æ¡£å¯èƒ½è¿‡äºå¤æ‚ï¼Œå»ºè®®å¤§å¹…ç®€åŒ–è¯­è¨€å’Œå¥å­ç»“æ„ï¼Œæé«˜å¯è¯»æ€§ã€‚";
            }

            // æ·»åŠ å…·ä½“ç»Ÿè®¡ä¿¡æ¯
            if (readability.total_words && readability.total_sentences) {
                const avgWordsPerSentence = readability.average_words_per_sentence || 0;
                const complexWordsRatio = readability.complex_words_ratio || 0;

                summary += `<br><br>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼š<br>`;
                summary += `â€¢ æ€»è¯æ•°ï¼š${readability.total_words}ï¼Œæ€»å¥æ•°ï¼š${readability.total_sentences}<br>`;
                summary += `â€¢ å¹³å‡å¥é•¿ï¼š${avgWordsPerSentence.toFixed(1)}è¯/å¥<br>`;
                summary += `â€¢ å¤æ‚è¯æ¯”ä¾‹ï¼š${(complexWordsRatio * 100).toFixed(1)}%<br>`;
                summary += `â€¢ é¢„ä¼°é˜…è¯»å¹´çº§ï¼š${gradeLevel.toFixed(1)}å¹´çº§`;
            }

            return summary;
        }

        function getStrengthDetail(strength) {
            const details = {
                "æ–‡æ¡£ç»“æ„æ¸…æ™°ï¼Œä¾¿äºé˜…è¯»": "è‰¯å¥½çš„å±‚æ¬¡ç»“æ„å’Œç»„ç»‡æ–¹å¼",
                "åŒ…å«äº†å¿…è¦çš„å®‰è£…å’Œä½¿ç”¨è¯´æ˜": "å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå¼€å§‹ä½¿ç”¨é¡¹ç›®",
                "æä¾›äº†è¯¦ç»†çš„APIæ–‡æ¡£": "æ–¹ä¾¿å¼€å‘è€…ç†è§£å’Œä½¿ç”¨",
                "åŒ…å«äº†ç¤ºä¾‹ä»£ç ": "å¸®åŠ©ç”¨æˆ·ç†è§£å¦‚ä½•å®é™…åº”ç”¨",
                "æœ‰å®Œæ•´çš„é—®é¢˜è§£ç­”": "è§£å†³å¸¸è§çš„ä½¿ç”¨é—®é¢˜",
                "æ›´æ–°åŠæ—¶": "æ–‡æ¡£ä¸ä»£ç ä¿æŒåŒæ­¥",
                "å›½é™…åŒ–æ”¯æŒ": "æ”¯æŒå¤šè¯­è¨€ç”¨æˆ·"
            };
            return details[strength] || "è¿™ä¸€ç‚¹æ˜¾è‘—æå‡äº†æ–‡æ¡£è´¨é‡";
        }

        function toggleCollapse(element) {
            const collapse = element.parentElement;
            collapse.classList.toggle('active');
            const icon = element.querySelector('.fa-chevron-down');
            if (collapse.classList.contains('active')) {
                icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
            } else {
                icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
            }
        }

        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                // æ›´æ–°å¯¼èˆªçŠ¶æ€
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.target.classList.add('active');

                // æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®
                window.scrollTo({
                    top: element.offsetTop - 100,
                    behavior: 'smooth'
                });
            }
        }

        function initNavigation() {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function (e) {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        function showSuggestionDetail(suggestion) {
            alert(`å»ºè®®è¯¦æƒ…ï¼š\n\n${suggestion}\n\nè¿™æ˜¯ä¸€ä¸ªä¸­ç­‰ä¼˜å…ˆçº§çš„æ”¹è¿›å»ºè®®ã€‚`);
        }

        function downloadReadme(repoName, encodedContent) {
            const content = decodeURIComponent(escape(atob(encodedContent)));
            const blob = new Blob([content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${repoName.replace('/', '_')}_README.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function shareAnalysis() {
            if (navigator.share) {
                navigator.share({
                    title: 'GitHub README åˆ†ææŠ¥å‘Š',
                    text: 'æŸ¥çœ‹è¿™ä¸ªGitHubä»“åº“çš„READMEæ–‡æ¡£åˆ†ææŠ¥å‘Š',
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                });
            }
        }

        function showError(message) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="analysis-card" style="background: linear-gradient(135deg, #ff6b6b, #c0392b); color: white;">
                    <div style="text-align: center; padding: 60px 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 4rem; margin-bottom: 30px;"></i>
                        <h2 style="margin-bottom: 20px;">åˆ†æå¤±è´¥</h2>
                        <p style="margin-bottom: 30px; opacity: 0.9;">${message}</p>
                        
                        <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: left;">
                            <h4 style="margin-bottom: 15px;">å¯èƒ½çš„åŸå› ï¼š</h4>
                            <ul style="list-style: none; padding-left: 0;">
                                <li style="margin-bottom: 10px;"><i class="fas fa-times-circle"></i> ä»“åº“åœ°å€é”™è¯¯æˆ–ä¸å­˜åœ¨</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-lock"></i> ä»“åº“ä¸ºç§æœ‰ä»“åº“ï¼Œæ— æ³•è®¿é—®</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-wifi"></i> ç½‘ç»œè¿æ¥é—®é¢˜</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-file"></i> ä»“åº“ä¸­æ²¡æœ‰READMEæ–‡ä»¶</li>
                                <li><i class="fas fa-server"></i> åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–è¿æ¥å¤±è´¥</li>
                            </ul>
                        </div>
                        
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn" onclick="location.reload()" style="background: white; color: #c0392b;">
                                <i class="fas fa-redo"></i> é‡æ–°å°è¯•
                            </button>
                            <button class="btn" onclick="window.history.back()" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-arrow-left"></i> è¿”å›
                            </button>
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function showEnhancedError(message, suggestions) {
            const resultDiv = document.getElementById('result');
            const suggestionsHtml = suggestions.map(suggestion =>
                `<li style="margin-bottom: 10px;"><i class="fas fa-lightbulb"></i> ${suggestion}</li>`
            ).join('');

            resultDiv.innerHTML = `
                <div class="analysis-card" style="background: linear-gradient(135deg, #ff6b6b, #c0392b); color: white;">
                    <div style="text-align: center; padding: 60px 40px;">
                        <i class="fas fa-exclamation-circle" style="font-size: 4rem; margin-bottom: 30px;"></i>
                        <h2 style="margin-bottom: 20px;">åˆ†æå¤±è´¥</h2>
                        <p style="margin-bottom: 30px; opacity: 0.9;">${message}</p>

                        ${suggestions.length > 0 ? `
                        <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 20px; text-align: left;">
                            <h4 style="margin-bottom: 15px;"><i class="fas fa-magic"></i> å»ºè®®è§£å†³æ–¹æ¡ˆï¼š</h4>
                            <ul style="list-style: none; padding-left: 0;">
                                ${suggestionsHtml}
                            </ul>
                        </div>
                        ` : ''}

                        <div style="background: rgba(255,255,255,0.1); padding: 25px; border-radius: 15px; margin-bottom: 30px; text-align: left;">
                            <h4 style="margin-bottom: 15px;">å¯èƒ½çš„åŸå› ï¼š</h4>
                            <ul style="list-style: none; padding-left: 0;">
                                <li style="margin-bottom: 10px;"><i class="fas fa-times-circle"></i> ä»“åº“åœ°å€é”™è¯¯æˆ–ä¸å­˜åœ¨</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-lock"></i> ä»“åº“ä¸ºç§æœ‰ä»“åº“ï¼Œæ— æ³•è®¿é—®</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-wifi"></i> ç½‘ç»œè¿æ¥é—®é¢˜</li>
                                <li style="margin-bottom: 10px;"><i class="fas fa-file"></i> ä»“åº“ä¸­æ²¡æœ‰READMEæ–‡ä»¶</li>
                                <li><i class="fas fa-server"></i> åç«¯æœåŠ¡æœªå¯åŠ¨æˆ–è¿æ¥å¤±è´¥</li>
                            </ul>
                        </div>

                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button class="btn" onclick="retryAnalysis()" style="background: white; color: #c0392b;">
                                <i class="fas fa-redo"></i> é‡è¯•åˆ†æ
                            </button>
                            <button class="btn" onclick="resetForm()" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function retryAnalysis() {
            // é‡æ–°æ‰§è¡Œåˆ†æï¼Œä½¿ç”¨å½“å‰çš„è®¾ç½®
            const selectedTypes = getSelectedDocTypes();
            if (selectedTypes.length > 0) {
                startDeepAnalysis();
            } else {
                showError("è¯·å…ˆé€‰æ‹©è¦åˆ†æçš„æ–‡æ¡£");
            }
        }

        function resetForm() {
            // é‡ç½®è¡¨å•åˆ°åˆå§‹çŠ¶æ€
            document.getElementById('result').style.display = 'none';
            document.getElementById('analysis-section').style.display = 'none';
            document.getElementById('scan-section').style.display = 'block';
            document.getElementById('repo-url').value = '';
            document.getElementById('repo-url').focus();
        }

        async function optimizeSingleDocument() {
            // åªä»é€‰ä¸­çš„æ–‡æ¡£ä¸­é€‰æ‹©
            const availableDocs = Object.keys(window.selectedDocs || {}).filter(docType => {
                const doc = window.selectedDocs[docType];
                return doc && doc.content;
            });

            if (availableDocs.length === 0) {
                showEnhancedError("æ²¡æœ‰å¯ä¼˜åŒ–çš„æ–‡æ¡£", ["è¯·å…ˆæ‰«æä»“åº“è·å–æ–‡æ¡£"]);
                return;
            }

            // æ˜¾ç¤ºæ–‡æ¡£é€‰æ‹©å¯¹è¯æ¡†
            showDocumentSelectionDialog(availableDocs);
        }

        function showDocumentSelectionDialog(availableDocs) {
            const resultDiv = document.getElementById('result');

            const dialogHtml = `
                <div class="analysis-card animate-in" style="max-width: 600px; margin: 50px auto;">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-primary);">
                            <i class="fas fa-list-check"></i>
                        </div>
                        <div>
                            <h2 class="card-title">é€‰æ‹©è¦ä¼˜åŒ–çš„æ–‡æ¡£</h2>
                            <p class="card-subtitle">è¯·é€‰æ‹©ä¸€ä¸ªæ–‡æ¡£è¿›è¡ŒAIä¼˜åŒ–</p>
                        </div>
                    </div>

                    <div style="padding: 25px;">
                        <div style="margin-bottom: 25px;">
                            <label style="display: block; margin-bottom: 15px; font-weight: 600; color: var(--dark);">
                                <i class="fas fa-file-alt"></i> å¯ä¼˜åŒ–æ–‡æ¡£ï¼š
                            </label>
                            <div style="display: grid; gap: 10px;">
                                ${availableDocs.map(docType => {
                const doc = window.selectedDocs[docType];
                return `
                                        <label class="doc-selection-item" style="display: flex; align-items: center; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                            <input type="radio" name="selectedDoc" value="${docType}" style="margin-right: 15px;">
                                            <div style="flex: 1;">
                                                <div style="font-weight: 600; color: var(--dark); margin-bottom: 5px;">
                                                    ${docType.toUpperCase()}
                                                </div>
                                                <div style="font-size: 14px; color: var(--gray);">
                                                    ${doc.content.length.toLocaleString()} å­—ç¬¦ â€¢ ${doc.content.split('\n').length} è¡Œ
                                                </div>
                                            </div>
                                            <div style="color: var(--primary);">
                                                <i class="fas fa-file-alt"></i>
                                            </div>
                                        </label>
                                    `;
            }).join('')}
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; justify-content: flex-end;">
                            <button class="btn btn-outline" onclick="hideDocumentSelectionDialog()">
                                <i class="fas fa-times"></i> å–æ¶ˆ
                            </button>
                            <button class="btn" onclick="confirmDocumentSelection()">
                                <i class="fas fa-wand-magic-sparkles"></i> å¼€å§‹ä¼˜åŒ–
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // ä¿å­˜åŸå§‹å†…å®¹
            window.originalResultContent = resultDiv.innerHTML;

            resultDiv.innerHTML = dialogHtml;
            resultDiv.style.display = 'block';

            // æ·»åŠ æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .doc-selection-item:hover {
                    border-color: var(--primary);
                    background: rgba(52, 152, 219, 0.05);
                }
                .doc-selection-item input[type="radio"]:checked {
                    accent-color: var(--primary);
                }
            .doc-selection-item:has(input[type="radio"]:checked) {
                border-color: var(--primary);
                background: rgba(52, 152, 219, 0.1);
            }

            .btn-secondary.active {
                background: var(--primary);
                color: white;
            }
            `;
            document.head.appendChild(style);
            window.selectionDialogStyle = style;
        }

        function hideDocumentSelectionDialog() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = window.originalResultContent || '';

            // ç§»é™¤æ ·å¼
            if (window.selectionDialogStyle) {
                document.head.removeChild(window.selectionDialogStyle);
                window.selectionDialogStyle = null;
            }
        }

        async function confirmDocumentSelection() {
            const selectedRadio = document.querySelector('input[name="selectedDoc"]:checked');
            if (!selectedRadio) {
                alert('è¯·é€‰æ‹©è¦ä¼˜åŒ–çš„æ–‡æ¡£');
                return;
            }

            const docType = selectedRadio.value;
            const doc = window.selectedDocs[docType];

            // éšè—é€‰æ‹©å¯¹è¯æ¡†
            hideDocumentSelectionDialog();

            // å¼€å§‹ä¼˜åŒ–è¿‡ç¨‹
            await performDocumentOptimization(docType, doc);
        }

        async function performDocumentOptimization(docType, doc) {

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById('result');

            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>ä¼˜åŒ–ä¸­...</span>';
            loading.style.display = 'block';
            resultDiv.style.display = 'none';

            // è®¾ç½®åŠ è½½æ–‡å­—
            document.getElementById('loadingTitle').textContent = `æ­£åœ¨ä¼˜åŒ– ${docType.toUpperCase()} æ–‡æ¡£...`;
            document.getElementById('loadingDescription').innerHTML = `åŸºäºAIåˆ†æç»“æœä¼˜åŒ–æ–‡æ¡£ç»“æ„ã€å†…å®¹å’Œæ ¼å¼`;

            try {
                const response = await fetch('http://localhost:8000/api/optimize-document', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        original_content: doc.content,
                        analysis_result: window.analysisData.ai_analysis, // åªä¼ é€’ ai_analysis éƒ¨åˆ†
                        doc_type: docType
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || "ä¼˜åŒ–å¤±è´¥");
                }

                // æ˜¾ç¤ºä¼˜åŒ–ç»“æœï¼ˆå¦‚æœåç«¯è¿”å›äº† diff_htmlï¼Œåˆ™ä½¿ç”¨å®ƒï¼‰
                showOptimizationResult(docType, doc.content, result.optimized_content, result.changes_summary, result.diff_html);

            } catch (error) {
                console.error('ä¼˜åŒ–å¤±è´¥:', error);
                showEnhancedError("æ–‡æ¡£ä¼˜åŒ–å¤±è´¥", [
                    error.message.includes('500') ? "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•" : "ç½‘ç»œè¿æ¥é”™è¯¯",
                    "å°è¯•é€‰æ‹©å…¶ä»–æ–‡æ¡£è¿›è¡Œä¼˜åŒ–",
                    "æ£€æŸ¥AIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ"
                ]);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                loading.style.display = 'none';
            }
        }

        async function optimizeBatchDocuments() {
            // åªä»é€‰ä¸­çš„æ–‡æ¡£ä¸­é€‰æ‹©
            const availableDocs = Object.keys(window.selectedDocs || {}).filter(docType => {
                const doc = window.selectedDocs[docType];
                return doc && doc.content;
            });

            if (availableDocs.length === 0) {
                showEnhancedError("æ²¡æœ‰å¯ä¼˜åŒ–çš„æ–‡æ¡£", ["è¯·å…ˆæ‰«æä»“åº“è·å–æ–‡æ¡£"]);
                return;
            }

            if (!confirm(`ç¡®å®šè¦æ‰¹é‡ä¼˜åŒ– ${availableDocs.length} ä¸ªæ–‡æ¡£å—ï¼Ÿ\n\nè¿™å°†åŸºäºAIåˆ†æç»“æœè‡ªåŠ¨ä¼˜åŒ–æ‰€æœ‰æ–‡æ¡£å†…å®¹ã€‚`)) {
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            const analyzeBtn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('loading');
            const resultDiv = document.getElementById('result');

            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>æ‰¹é‡ä¼˜åŒ–ä¸­...</span>';
            loading.style.display = 'block';
            resultDiv.style.display = 'none';

            // è®¾ç½®åŠ è½½æ–‡å­—
            document.getElementById('loadingTitle').textContent = "æ­£åœ¨æ‰¹é‡ä¼˜åŒ–æ–‡æ¡£...";
            document.getElementById('loadingDescription').innerHTML = `ä¼˜åŒ– ${availableDocs.length} ä¸ªæ–‡æ¡£ï¼Œå¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´`;

            try {
                const documents = availableDocs.map(docType => ({
                    doc_type: docType,
                    original_content: window.selectedDocs[docType].content,
                    analysis_result: window.analysisData.ai_analysis  // åªä¼ é€’ ai_analysis éƒ¨åˆ†
                }));

                const response = await fetch('http://localhost:8000/api/batch-optimize', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        documents: documents
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();

                if (!result.success) {
                    throw new Error(result.error || "æ‰¹é‡ä¼˜åŒ–å¤±è´¥");
                }

                // å­˜å‚¨æ‰¹é‡ä¼˜åŒ–ç»“æœç”¨äºä¸‹è½½
                window.batchOptimizedData = {
                    results: result.results,
                    diffs: result.diffs,
                    timestamp: new Date().toISOString()
                };

                // æ˜¾ç¤ºæ‰¹é‡ä¼˜åŒ–ç»“æœ
                showBatchOptimizationResult(result.results, result.diffs);

            } catch (error) {
                console.error('æ‰¹é‡ä¼˜åŒ–å¤±è´¥:', error);
                showEnhancedError("æ‰¹é‡ä¼˜åŒ–å¤±è´¥", [
                    error.message.includes('500') ? "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•" : "ç½‘ç»œè¿æ¥é”™è¯¯",
                    "å°è¯•å‡å°‘æ–‡æ¡£æ•°é‡",
                    "æ£€æŸ¥AIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ"
                ]);
            } finally {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '<i class="fas fa-magic"></i><span>å¼€å§‹æ·±åº¦åˆ†æ</span>';
                loading.style.display = 'none';
            }
        }

        function showOptimizationResult(docType, originalContent, optimizedContent, changesSummary, diffHtml) {
            const resultDiv = document.getElementById('result');

            let changesHtml = '';
            if (changesSummary) {
                changesHtml = `
                    <div class="optimization-summary-card">
                        <div class="summary-header">
                            <i class="fas fa-chart-line"></i>
                            <h4>ä¼˜åŒ–ç»Ÿè®¡</h4>
                        </div>
                        <div class="optimization-stats">
                            ${Object.entries(changesSummary).map(([key, value]) => `
                                <div class="stat-item">
                                    <span class="stat-value">${value}</span>
                                    <span class="stat-label">${key}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // å¦‚æœæœ‰ diff_htmlï¼Œä½¿ç”¨å®ƒæ¥æ˜¾ç¤ºå·®å¼‚å¯¹æ¯”ï¼ˆçº¢ç»¿è‰²é«˜äº®ï¼‰
            const comparisonHtml = diffHtml ? `
                <div style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px; color: var(--dark);">
                        <i class="fas fa-exchange-alt"></i> å†…å®¹å·®å¼‚å¯¹æ¯”
                    </h3>
                    <div style="max-height: 600px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                        ${diffHtml}
                    </div>
                </div>
            ` : `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
                    <div class="document-comparison">
                        <div class="comparison-header">
                            <h3 class="comparison-title original-title">
                                <i class="fas fa-file-alt"></i> åŸå§‹æ–‡æ¡£
                                <span class="doc-stats">${originalContent.length.toLocaleString()} å­—ç¬¦</span>
                            </h3>
                        </div>
                        <div class="document-content original-content">
                            <div class="markdown-content">
                                ${marked.parse(originalContent.substring(0, 1500))}${originalContent.length > 1500 ? '<div class="content-truncate">... (å†…å®¹è¿‡é•¿ï¼Œä»…æ˜¾ç¤ºå‰1500å­—ç¬¦)</div>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="document-comparison">
                        <div class="comparison-header">
                            <h3 class="comparison-title optimized-title">
                                <i class="fas fa-magic"></i> ä¼˜åŒ–åæ–‡æ¡£
                                <span class="doc-stats">${optimizedContent.length.toLocaleString()} å­—ç¬¦</span>
                            </h3>
                        </div>
                        <div class="document-content optimized-content">
                            <div class="markdown-content">
                                ${marked.parse(optimizedContent.substring(0, 1500))}${optimizedContent.length > 1500 ? '<div class="content-truncate">... (å†…å®¹è¿‡é•¿ï¼Œä»…æ˜¾ç¤ºå‰1500å­—ç¬¦)</div>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            resultDiv.innerHTML = `
                <div class="analysis-card animate-in">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-primary);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h2 class="card-title">æ–‡æ¡£ä¼˜åŒ–å®Œæˆ</h2>
                            <p class="card-subtitle">${docType.toUpperCase()} æ–‡æ¡£å·²æˆåŠŸä¼˜åŒ–</p>
                        </div>
                    </div>

                    <div style="padding: 25px;">
                        ${comparisonHtml}

                        ${changesHtml}

                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn" onclick="downloadOptimizedDocument('${docType}', '${btoa(unescape(encodeURIComponent(optimizedContent)))}')">
                                <i class="fas fa-download"></i> ä¸‹è½½ä¼˜åŒ–åçš„æ–‡æ¡£
                            </button>
                            <button class="btn btn-outline" onclick="location.reload()">
                                <i class="fas fa-arrow-left"></i> è¿”å›åˆ†æç»“æœ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function showBatchOptimizationResult(results, diffs) {
            const resultDiv = document.getElementById('result');

            let resultsHtml = results.map((result, index) => {
                const diff = diffs[index];
                const optimizedContent = result.optimized_content || result.content;
                const originalContent = result.original_content || (window.selectedDocs && window.selectedDocs[result.doc_type] ? window.selectedDocs[result.doc_type].content : 'æš‚æ— åŸå§‹å†…å®¹');
                const displayContent = optimizedContent.substring(0, 1000) + (optimizedContent.length > 1000 ? '\n\n... (å†…å®¹è¿‡é•¿ï¼Œä»…æ˜¾ç¤ºå‰1000å­—ç¬¦)' : '');
                const originalDisplayContent = originalContent.substring(0, 1000) + (originalContent.length > 1000 ? '\n\n... (å†…å®¹è¿‡é•¿ï¼Œä»…æ˜¾ç¤ºå‰1000å­—ç¬¦)' : '');

                return `
                    <div style="border: 1px solid #e0e0e0; border-radius: 10px; margin-bottom: 20px; overflow: hidden;">
                        <div style="background: #f8f9fa; padding: 15px; border-bottom: 1px solid #e0e0e0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0; color: #2c3e50;">
                                    <i class="fas fa-file-alt"></i> ${result.doc_type.toUpperCase()}
                                </h4>
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn-secondary" style="padding: 5px 10px; font-size: 12px;" onclick="toggleBatchView('${result.doc_type}', 'content', ${index})">
                                        <i class="fas fa-file"></i> æŸ¥çœ‹å†…å®¹
                                    </button>
                                    <button class="btn-secondary active" style="padding: 5px 10px; font-size: 12px;" onclick="toggleBatchView('${result.doc_type}', 'diff', ${index})">
                                        <i class="fas fa-exchange-alt"></i> æŸ¥çœ‹å·®å¼‚
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div style="padding: 15px;">

                            <!-- ä¼˜åŒ–åå†…å®¹è§†å›¾ -->
                            <div id="content-view-${result.doc_type}-${index}" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none;">
                                <h5 style="margin-top: 0; margin-bottom: 10px; color: #2c3e50;">
                                    <i class="fas fa-magic"></i> ä¼˜åŒ–åå†…å®¹
                                </h5>
                                <div class="markdown-content" style="max-height: 300px; overflow-y: auto; background: white; padding: 15px; border-radius: 6px; border: 1px solid #e0e0e0;">
                                    ${marked.parse(displayContent)}
                                </div>
                            </div>

                            <!-- å·®å¼‚è§†å›¾ - ä½¿ç”¨åç«¯è¿”å›çš„ diff_html -->
                            <div id="diff-view-${result.doc_type}-${index}" style="display: block;">
                                <h5 style="margin-top: 0; margin-bottom: 15px; color: #2c3e50;">
                                    <i class="fas fa-exchange-alt"></i> å†…å®¹å¯¹æ¯”
                                </h5>
                                ${diff && diff.diff_html ? `
                                    <div style="max-height: 500px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px;">
                                        ${diff.diff_html}
                                    </div>
                                ` : `
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                        <div class="document-comparison">
                                            <div class="comparison-header">
                                                <h4 class="comparison-title original-title" style="font-size: 1rem; margin: 0; padding: 10px 15px;">
                                                    <i class="fas fa-file-alt"></i> åŸå§‹å†…å®¹
                                                    <span class="doc-stats" style="font-size: 0.8rem;">${originalContent.length.toLocaleString()} å­—ç¬¦</span>
                                                </h4>
                                            </div>
                                            <div class="document-content original-content" style="max-height: 300px;">
                                                <div class="markdown-content" style="padding: 15px;">
                                                    ${marked.parse(originalDisplayContent)}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="document-comparison">
                                            <div class="comparison-header">
                                                <h4 class="comparison-title optimized-title" style="font-size: 1rem; margin: 0; padding: 10px 15px;">
                                                    <i class="fas fa-magic"></i> ä¼˜åŒ–åå†…å®¹
                                                    <span class="doc-stats" style="font-size: 0.8rem;">${optimizedContent.length.toLocaleString()} å­—ç¬¦</span>
                                                </h4>
                                            </div>
                                            <div class="document-content optimized-content" style="max-height: 300px;">
                                                <div class="markdown-content" style="padding: 15px;">
                                                    ${marked.parse(displayContent)}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `}
                                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                                    <strong>å·®å¼‚ç»Ÿè®¡ï¼š</strong>
                                    <span style="color: #27ae60; margin-left: 10px;"><i class="fas fa-plus"></i> æ·»åŠ : ${diff ? (diff.additions || 0) : 0} è¡Œ</span>
                                    <span style="color: #e74c3c; margin-left: 15px;"><i class="fas fa-minus"></i> åˆ é™¤: ${diff ? (diff.deletions || 0) : 0} è¡Œ</span>
                                    <span style="color: #f39c12; margin-left: 15px;"><i class="fas fa-edit"></i> ä¿®æ”¹: ${diff ? (diff.modifications || 0) : 0} è¡Œ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            resultDiv.innerHTML = `
                <div class="analysis-card animate-in">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-success);">
                            <i class="fas fa-magic"></i>
                        </div>
                        <div>
                            <h2 class="card-title">æ‰¹é‡ä¼˜åŒ–å®Œæˆ</h2>
                            <p class="card-subtitle">å·²ä¼˜åŒ– ${results.length} ä¸ªæ–‡æ¡£</p>
                        </div>
                    </div>

                    <div style="padding: 25px;">
                        ${resultsHtml}

                        <div style="text-align: center; margin-top: 30px;">
                            <button class="btn" onclick="downloadBatchOptimized()">
                                <i class="fas fa-download"></i> ä¸‹è½½æ‰€æœ‰ä¼˜åŒ–æ–‡æ¡£
                            </button>
                            <button class="btn btn-outline" onclick="location.reload()">
                                <i class="fas fa-arrow-left"></i> è¿”å›åˆ†æç»“æœ
                            </button>
                        </div>
                    </div>
                </div>
            `;
            resultDiv.style.display = 'block';
        }

        function downloadOptimizedDocument(docType, content) {
            const decodedContent = decodeURIComponent(escape(atob(content)));
            const blob = new Blob([decodedContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `optimized_${docType}.md`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadBatchOptimized() {
            if (!window.batchOptimizedData || !window.batchOptimizedData.results) {
                showEnhancedError("æ²¡æœ‰æ‰¹é‡ä¼˜åŒ–æ•°æ®", ["è¯·å…ˆæ‰§è¡Œæ‰¹é‡ä¼˜åŒ–æ“ä½œ"]);
                return;
            }

            const results = window.batchOptimizedData.results;
            const repoInfo = window.scannedData.repo_info || {};
            const repoName = repoInfo.full_name || 'unknown-repo';

            // æ˜¾ç¤ºä¸‹è½½é€‰é¡¹å¯¹è¯æ¡†
            showDownloadOptionsDialog(results, repoName);
        }

        function showDownloadOptionsDialog(results, repoName) {
            const resultDiv = document.getElementById('result');

            const optionsHtml = `
                <div class="analysis-card animate-in" style="max-width: 600px; margin: 50px auto;">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-primary);">
                            <i class="fas fa-download"></i>
                        </div>
                        <div>
                            <h2 class="card-title">æ‰¹é‡ä¸‹è½½é€‰é¡¹</h2>
                            <p class="card-subtitle">é€‰æ‹©ä¸‹è½½æ–¹å¼</p>
                        </div>
                    </div>

                    <div style="padding: 25px;">
                        <div style="margin-bottom: 25px;">
                            <div style="display: grid; gap: 15px;">
                                <label class="download-option" style="display: flex; align-items: center; padding: 20px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                    <input type="radio" name="downloadType" value="individual" checked style="margin-right: 15px;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 5px;">
                                            <i class="fas fa-file-download"></i> é€ä¸ªä¸‹è½½
                                        </div>
                                        <div style="font-size: 14px; color: var(--gray);">
                                            åˆ†åˆ«ä¸‹è½½æ¯ä¸ªä¼˜åŒ–åçš„æ–‡æ¡£æ–‡ä»¶
                                        </div>
                                    </div>
                                </label>

                                <label class="download-option" style="display: flex; align-items: center; padding: 20px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s ease;">
                                    <input type="radio" name="downloadType" value="combined" style="margin-right: 15px;">
                                    <div style="flex: 1;">
                                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 5px;">
                                            <i class="fas fa-file-archive"></i> åˆå¹¶ä¸‹è½½
                                        </div>
                                        <div style="font-size: 14px; color: var(--gray);">
                                            å°†æ‰€æœ‰æ–‡æ¡£åˆå¹¶ä¸ºä¸€ä¸ªJSONæ–‡ä»¶ä¸‹è½½
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <div style="text-align: center;">
                            <button class="btn" onclick="executeBatchDownload('${repoName}')">
                                <i class="fas fa-download"></i> å¼€å§‹ä¸‹è½½
                            </button>
                            <button class="btn btn-outline" onclick="hideDownloadOptionsDialog()" style="margin-left: 15px;">
                                <i class="fas fa-times"></i> å–æ¶ˆ
                            </button>
                        </div>
                    </div>
                </div>
            `;

            // ä¿å­˜åŸå§‹å†…å®¹
            window.originalResultContent = resultDiv.innerHTML;

            resultDiv.innerHTML = optionsHtml;
            resultDiv.style.display = 'block';

            // æ·»åŠ é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.download-option').forEach(option => {
                option.addEventListener('click', function () {
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                });
            });

            // æ·»åŠ æ ·å¼
            const style = document.createElement('style');
            style.textContent = `
                .download-option:hover {
                    border-color: var(--primary);
                    background: rgba(52, 152, 219, 0.05);
                }
                .download-option:has(input[type="radio"]:checked) {
                    border-color: var(--primary);
                    background: rgba(52, 152, 219, 0.1);
                }
            `;
            document.head.appendChild(style);
            window.downloadDialogStyle = style;
        }

        function hideDownloadOptionsDialog() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = window.originalResultContent || '';

            // ç§»é™¤æ ·å¼
            if (window.downloadDialogStyle) {
                document.head.removeChild(window.downloadDialogStyle);
                window.downloadDialogStyle = null;
            }
        }

        function executeBatchDownload(repoName) {
            const downloadType = document.querySelector('input[name="downloadType"]:checked').value;
            const results = window.batchOptimizedData.results;

            hideDownloadOptionsDialog();

            if (downloadType === 'individual') {
                // é€ä¸ªä¸‹è½½
                downloadIndividualFiles(results, repoName);
            } else {
                // åˆå¹¶ä¸‹è½½
                downloadCombinedFile(results, repoName);
            }
        }

        function downloadIndividualFiles(results, repoName) {
            results.forEach((result, index) => {
                setTimeout(() => {
                    const fileName = `${repoName}_${result.doc_type}_optimized.md`;
                    const content = result.optimized_content || result.content;
                    downloadDocument(repoName, fileName, btoa(unescape(encodeURIComponent(content))));
                }, index * 1000); // æ¯éš”1ç§’ä¸‹è½½ä¸€ä¸ªï¼Œé¿å…æµè§ˆå™¨é˜»æ­¢
            });

            showSuccessMessage(`æ­£åœ¨é€ä¸ªä¸‹è½½ ${results.length} ä¸ªæ–‡ä»¶ï¼Œè¯·å…è®¸æµè§ˆå™¨å¼¹å‡ºä¸‹è½½çª—å£ã€‚`);
        }

        function downloadCombinedFile(results, repoName) {
            const combinedData = {
                repository: repoName,
                optimization_timestamp: window.batchOptimizedData.timestamp,
                documents: results.map(result => ({
                    doc_type: result.doc_type,
                    optimized_content: result.optimized_content || result.content,
                    changes_summary: result.changes_summary
                }))
            };

            const jsonContent = JSON.stringify(combinedData, null, 2);
            const fileName = `${repoName}_batch_optimized_${new Date().toISOString().split('T')[0]}.json`;

            const blob = new Blob([jsonContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showSuccessMessage(`æ‰¹é‡ä¼˜åŒ–æ–‡ä»¶å·²ä¸‹è½½ï¼š${fileName}`);
        }

        function showSuccessMessage(message) {
            const resultDiv = document.getElementById('result');

            const successHtml = `
                <div class="analysis-card animate-in" style="max-width: 500px; margin: 50px auto;">
                    <div class="card-header">
                        <div class="card-icon" style="background: var(--gradient-success);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div>
                            <h2 class="card-title">ä¸‹è½½æˆåŠŸ</h2>
                            <p class="card-subtitle">${message}</p>
                        </div>
                    </div>

                    <div style="padding: 25px; text-align: center;">
                        <button class="btn" onclick="location.reload()">
                            <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
                        </button>
                    </div>
                </div>
            `;

            resultDiv.innerHTML = successHtml;
        }

        // æ·»åŠ æ»šåŠ¨åˆ°æ–‡æ¡£çš„å‡½æ•°
        function scrollToDocument(docType) {
            showDocumentContent(docType, null);
            scrollToSection('preview');
        }

        // ä¿®æ”¹showDocumentContentå‡½æ•°ï¼Œåœ¨æ–‡æ¡£æ ‡ç­¾ä¸Šæ˜¾ç¤ºåˆ†æ•°
        function showDocumentContent(docType, event) {
            // æ›´æ–°æ ‡ç­¾é¡µæ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.doc-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // å¦‚æœæœ‰äº‹ä»¶å¯¹è±¡ï¼Œæ¿€æ´»å¯¹åº”çš„æ ‡ç­¾é¡µ
            if (event && event.target) {
                event.target.closest('.doc-tab').classList.add('active');
            } else {
                // å¦‚æœæ²¡æœ‰äº‹ä»¶å¯¹è±¡ï¼Œé€šè¿‡docTypeæ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾é¡µ
                const targetTab = document.querySelector(`.doc-tab[onclick*="${docType}"]`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }
            }

            // è·å–æ–‡æ¡£å†…å®¹
            const doc = window.selectedDocs && window.selectedDocs[docType] ? window.selectedDocs[docType] : null;
            if (!doc || !doc.content) {
                document.getElementById('markdown-content').innerHTML = '<p style="color: #666; text-align: center;">æ–‡æ¡£å†…å®¹ä¸å¯ç”¨</p>';
                document.getElementById('document-stats').innerHTML = '';
                document.getElementById('download-btn').style.display = 'none';
                return;
            }

            // æ›´æ–°å†…å®¹æ˜¾ç¤ºï¼ˆé™åˆ¶æ˜¾ç¤ºé•¿åº¦ï¼‰
            const displayContent = doc.content.length > 5000 ? doc.content.substring(0, 5000) + '\n\n... (å†…å®¹è¿‡é•¿ï¼Œå·²æˆªæ–­ï¼Œå®Œæ•´å†…å®¹è¯·ä¸‹è½½æŸ¥çœ‹)' : doc.content;
            document.getElementById('markdown-content').innerHTML = marked.parse(displayContent);

            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            const stats = document.getElementById('document-stats');
            stats.innerHTML = `
        <i class="fas fa-file-code"></i> ${doc.content.length.toLocaleString()} å­—ç¬¦
        <span style="margin: 0 15px;">â€¢</span>
        <i class="fas fa-bars"></i> ${doc.content.split('\n').length} è¡Œ
    `;

            // æ›´æ–°ä¸‹è½½æŒ‰é’®
            const downloadBtn = document.getElementById('download-btn');
            downloadBtn.style.display = 'block';
            downloadBtn.innerHTML = `<i class="fas fa-download"></i> ä¸‹è½½${docType.toUpperCase()}`;
            downloadBtn.onclick = function () {
                const repoInfo = window.scannedData?.repo_info || {};
                const fileName = doc.filename || `${docType}.md`;
                downloadDocument(repoInfo.full_name || 'unknown', fileName, btoa(unescape(encodeURIComponent(doc.content))));
            };
        }

        function downloadDocument(repoName, fileName, content) {
            const blob = new Blob([decodeURIComponent(escape(atob(content)))], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function toggleBatchView(docType, viewType, index) {
            const contentView = document.getElementById(`content-view-${docType}-${index}`);
            const diffView = document.getElementById(`diff-view-${docType}-${index}`);
            const contentBtn = document.querySelector(`button[onclick*="toggleBatchView('${docType}', 'content', ${index})"]`);
            const diffBtn = document.querySelector(`button[onclick*="toggleBatchView('${docType}', 'diff', ${index})"]`);

            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
            if (contentBtn) contentBtn.classList.remove('active');
            if (diffBtn) diffBtn.classList.remove('active');

            if (viewType === 'content') {
                contentView.style.display = 'block';
                diffView.style.display = 'none';
                if (contentBtn) contentBtn.classList.add('active');
            } else if (viewType === 'diff') {
                contentView.style.display = 'none';
                diffView.style.display = 'block';
                if (diffBtn) diffBtn.classList.add('active');
            }
        }
    </script>
</body>

</html>